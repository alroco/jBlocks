(function(b){function a(a,e){var l,n,t;function u(a){b("body").addClass("noSelect");var c=parseInt(h.obj.css(q),10);l=m?a.pageX:a.pageY;n="auto"==c?0:c;J?(document.ontouchmove=function(b){b.preventDefault();r(b.touches[0])},document.ontouchend=v):(b(document).bind("mousemove",r),b(document).bind("mouseup",v),h.obj.bind("mouseup",v))}function k(a){if(1>g.ratio&&(a=a||window.event,x-=(a.wheelDelta?a.wheelDelta/120:-a.detail/3)*e.wheel,x=Math.min(g[e.axis]-s[e.axis],Math.max(0,x)),h.obj.css(q,x/f.ratio),
g.obj.css(q,-x),e.lockscroll||x!==g[e.axis]-s[e.axis]&&0!==x))a=b.event.fix(a),a.preventDefault()}function r(b){1>g.ratio&&(t=e.invertscroll&&J?Math.min(d[e.axis]-h[e.axis],Math.max(0,n+(l-(m?b.pageX:b.pageY)))):Math.min(d[e.axis]-h[e.axis],Math.max(0,n+((m?b.pageX:b.pageY)-l))),x=t*f.ratio,g.obj.css(q,-x),h.obj.css(q,t))}function v(){b("body").removeClass("noSelect");b(document).unbind("mousemove",r);b(document).unbind("mouseup",v);h.obj.unbind("mouseup",v);document.ontouchmove=document.ontouchend=
null}var s={obj:b(".viewport",a)},g={obj:b(".overview",a)},f={obj:b(".scrollbar",a)},d={obj:b(".track",f.obj)},h={obj:b(".thumb",f.obj)},m="x"===e.axis,q=m?"left":"top",j=m?"Width":"Height",x=0;t=n=0;l=void 0;var J="ontouchstart"in document.documentElement;this.update=function(b){s[e.axis]=s.obj[0]["offset"+j];g[e.axis]=g.obj[0]["scroll"+j];g.ratio=s[e.axis]/g[e.axis];f.obj.toggleClass("disable",1<=g.ratio);d[e.axis]="auto"===e.size?s[e.axis]:e.size;h[e.axis]=Math.min(d[e.axis],Math.max(0,"auto"===
e.sizethumb?d[e.axis]*g.ratio:e.sizethumb));f.ratio="auto"===e.sizethumb?g[e.axis]/d[e.axis]:(g[e.axis]-s[e.axis])/(d[e.axis]-h[e.axis]);x="relative"===b&&1>=g.ratio?Math.min(g[e.axis]-s[e.axis],Math.max(0,x)):0;x="bottom"===b&&1>=g.ratio?g[e.axis]-s[e.axis]:isNaN(parseInt(b,10))?x:parseInt(b,10);b=j.toLowerCase();h.obj.css(q,x/f.ratio);var a={};a[q]=-x;e.animation?g.obj.animate(a,e.animation):g.obj.css(q,-x);l=h.obj.offset()[q];f.obj.css(b,d[e.axis]);d.obj.css(b,d[e.axis]);h.obj.css(b,h[e.axis])};
this.update();J?s.obj[0].ontouchstart=function(b){1===b.touches.length&&(u(b.touches[0]),b.stopPropagation())}:(h.obj.bind("mousedown",u),d.obj.bind("mouseup",r));e.scroll&&window.addEventListener?(a[0].addEventListener("DOMMouseScroll",k,!1),a[0].addEventListener("mousewheel",k,!1)):e.scroll&&(a[0].onmousewheel=k);return this}b.tiny=b.tiny||{};b.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:50,invertscroll:!0,animation:0}};b.fn.tinyscrollbar=function(c){var e=
b.extend({},b.tiny.scrollbar.options,c);this.each(function(){b(this).data("tsb",new a(b(this),e))});return this};b.fn.tinyscrollbar_update=function(a){try{return b(this).data("tsb").update(a)}catch(e){return b(this)}}})(jQuery);
(function(b){function a(a){if(a&&void 0===a.allowPageScroll&&(void 0!==a.swipe||void 0!==a.swipeStatus))a.allowPageScroll=r;a||(a={});a=b.extend({},b.fn.swipe.defaults,a);return this.each(function(){var e=b(this),d=e.data(x);d||(d=new c(this,a),e.data(x,d))})}function c(a,c){function M(a){if(!0!==y.data(x+"_intouch")&&!(0<b(a.target).closest(c.excludedElements,y).length)){a=a.originalEvent;var C,e=j?a.touches[0]:a;z=d;j?B=a.touches.length:a.preventDefault();F=0;N=G=null;H=Q=D=0;O=1;for(var g=[],h=
0;5>=h;h++)g.push({start:{x:0,y:0},end:{x:0,y:0},delta:{x:0,y:0}});w=g;if(!j||B===c.fingers||c.fingers===f||K()){if(w[0].start.x=w[0].end.x=e.pageX,w[0].start.y=w[0].end.y=e.pageY,W=(new Date).getTime(),2==B&&(w[1].start.x=w[1].end.x=a.touches[1].pageX,w[1].start.y=w[1].end.y=a.touches[1].pageY,Q=H=P(w[0].start,w[1].start)),c.swipeStatus||c.pinchStatus)C=A(a,z)}else I(a),C=!1;if(!1===C)return z=q,A(a,z),C;p(!0);y.bind(Z,E);y.bind(aa,L)}}function E(b){b=b.originalEvent;if(!(z===m||z===q)){var a,p=
j?b.touches[0]:b;w[0].end.x=j?b.touches[0].pageX:p.pageX;w[0].end.y=j?b.touches[0].pageY:p.pageY;T=(new Date).getTime();G=U(w[0].start,w[0].end);j&&(B=b.touches.length);z=h;2==B&&(0==Q?(w[1].start.x=b.touches[1].pageX,w[1].start.y=b.touches[1].pageY,Q=H=P(w[0].start,w[1].start)):(w[1].end.x=b.touches[1].pageX,w[1].end.y=b.touches[1].pageY,H=P(w[0].end,w[1].end),N=1>O?k:u),O=(1*(H/Q)).toFixed(2));if(B===c.fingers||c.fingers===f||!j){var p=b,C=G;if(c.allowPageScroll===r||K())p.preventDefault();else{var d=
c.allowPageScroll===v;switch(C){case e:(c.swipeLeft&&d||!d&&c.allowPageScroll!=s)&&p.preventDefault();break;case l:(c.swipeRight&&d||!d&&c.allowPageScroll!=s)&&p.preventDefault();break;case n:(c.swipeUp&&d||!d&&c.allowPageScroll!=g)&&p.preventDefault();break;case t:(c.swipeDown&&d||!d&&c.allowPageScroll!=g)&&p.preventDefault()}}F=R(w[0].start,w[0].end);D=T-W;if(c.swipeStatus||c.pinchStatus)a=A(b,z);c.triggerOnTouchEnd||(p=!(c.maxTimeThreshold?!(D>=c.maxTimeThreshold):1),!0===(null!==c.threshold?F>=
c.threshold:null)?(z=m,a=A(b,z)):p&&(z=q,A(b,z)))}else z=q,A(b,z);!1===a&&(z=q,A(b,z))}}function L(b){b=b.originalEvent;if(b.touches&&0<b.touches.length)return!0;b.preventDefault();T=(new Date).getTime();0!=Q&&(H=P(w[0].end,w[1].end),O=(1*(H/Q)).toFixed(2),N=1>O?k:u);F=R(w[0].start,w[0].end);G=U(w[0].start,w[0].end);D=T-W;if(c.triggerOnTouchEnd||!1===c.triggerOnTouchEnd&&z===h){z=m;var a=N&&K()||!K(),C=0!==w[0].end.x;if((B===c.fingers||c.fingers===f||!j)&&C&&a)if(a=c.maxTimeThreshold?D>=c.maxTimeThreshold?
!1:!0:!0,C=null!==c.threshold?F>=c.threshold:null,(!0===C||null===C)&&a)A(b,z);else{if(!a||!1===C)z=q,A(b,z)}else z=q,A(b,z)}else z===h&&(z=q,A(b,z));y.unbind(Z,E,!1);y.unbind(aa,L,!1);p(!1)}function I(){H=Q=W=T=B=0;O=1;p(!1)}function A(b,a){var p=void 0;c.swipeStatus&&(p=c.swipeStatus.call(y,b,a,G||null,F||0,D||0,B));c.pinchStatus&&(N&&K())&&(p=c.pinchStatus.call(y,b,a,N||null,H||0,D||0,B,O));if(a===q&&c.click&&(1===B||!j)&&(isNaN(F)||0===F))p=c.click.call(y,b,b.target);if(a==m){c.swipe&&(p=c.swipe.call(y,
b,G,F,D,B));switch(G){case e:c.swipeLeft&&(p=c.swipeLeft.call(y,b,G,F,D,B));break;case l:c.swipeRight&&(p=c.swipeRight.call(y,b,G,F,D,B));break;case n:c.swipeUp&&(p=c.swipeUp.call(y,b,G,F,D,B));break;case t:c.swipeDown&&(p=c.swipeDown.call(y,b,G,F,D,B))}switch(N){case u:c.pinchIn&&(p=c.pinchIn.call(y,b,N||null,H||0,D||0,B,O));break;case k:c.pinchOut&&(p=c.pinchOut.call(y,b,N||null,H||0,D||0,B,O))}}(a===q||a===m)&&I(b);return p}function P(b,a){var p=Math.abs(b.x-a.x),c=Math.abs(b.y-a.y);return Math.round(Math.sqrt(p*
p+c*c))}function R(b,a){return Math.round(Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)))}function U(b,a){var p;p=Math.atan2(a.y-b.y,b.x-a.x);p=Math.round(180*p/Math.PI);0>p&&(p=360-Math.abs(p));return 45>=p&&0<=p?e:360>=p&&315<=p?e:135<=p&&225>=p?l:45<p&&135>p?t:n}function S(){y.unbind(X,M);y.unbind(Y,I);y.unbind(Z,E);y.unbind(aa,L);p(!1)}function K(){return c.pinchStatus||c.pinchIn||c.pinchOut}function p(b){y.data(x+"_intouch",!0===b?!0:!1)}var C=j||!c.fallbackToMouseEvents,X=C?"touchstart":
"mousedown",Z=C?"touchmove":"mousemove",aa=C?"touchend":"mouseup",Y="touchcancel",F=0,G=null,D=0,Q=0,H=0,O=1,N=0,y=b(a),z="start",B=0,w=null,W=0,T=0;try{y.bind(X,M),y.bind(Y,I)}catch(ba){b.error("events not supported "+X+","+Y+" on jQuery.swipe")}this.enable=function(){y.bind(X,M);y.bind(Y,I);return y};this.disable=function(){S();return y};this.destroy=function(){S();y.data(x,null);return y}}var e="left",l="right",n="up",t="down",u="in",k="out",r="none",v="auto",s="horizontal",g="vertical",f="all",
d="start",h="move",m="end",q="cancel",j="ontouchstart"in window,x="TouchSwipe";b.fn.swipe=function(c){var e=b(this),d=e.data(x);if(d&&"string"===typeof c){if(d[c])return d[c].apply(this,Array.prototype.slice.call(arguments,1));b.error("Method "+c+" does not exist on jQuery.swipe")}else if(!d&&("object"===typeof c||!c))return a.apply(this,arguments);return e};b.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,
pinchIn:null,pinchOut:null,pinchStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"button, input, select, textarea, a, .noSwipe"};b.fn.swipe.phases={PHASE_START:d,PHASE_MOVE:h,PHASE_END:m,PHASE_CANCEL:q};b.fn.swipe.directions={LEFT:e,RIGHT:l,UP:n,DOWN:t,IN:u,OUT:k};b.fn.swipe.pageScroll={NONE:r,HORIZONTAL:s,VERTICAL:g,AUTO:v};b.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:f}})(jQuery);
(function(b){function a(a){null==a&&(a=/^(.*?)[^\/]*$/.exec(x)[1]+"jblocks.worker.js");a=new Worker(a);a.addEventListener("message",function(a){a=a.data;"log"==a.cmd?b.jBlocks("log","[Worker]",a.args.str):b(document).trigger("jblocks.worker",a)});return a}function c(a){this.anchor=0<arguments.length?arguments[0]:null;this.blocks={};this.layoutsStack=[];this.layoutCache={};this.layoutCount=0;this.worker=this.geometrySizeSign=this.layoutSign=this.layouts=null;this.scrollable=!1;this.jBlocksLayoutTimer=
this.jBlocksResizeTimer=null;this.layoutInProgress=0;this.focusedBlockId=this.loggedIn=null;this.layoutData={rmk:{rows:{},cols:{}},maxSize:{w:1,h:1},misfits:{}};this.jBlocksIndex=h++;this.viewport={r:0,c:0,w:0,h:0,minw:3,minh:3,zoomSeed:1E3,fillHoles:!0,fixed:"width"};this.options={resizeDelay:50,layoutDelay:50,resizeAnimateDelay:400,scrollAnimateDelay:400,resizeCallback:function(){},scrollable:!1,debug:!1,debugBlockLayout:!1,blockClass:null,blockContentClass:null,defaultOnResize:function(b,a){this.updateViewportFromGeometry(b,
a,{pixels:75,minw:12,maxw:30,minh:12,maxh:24})},onResize:function(a,p){var c=b.jBlocks("getFrameData");c&&"function"==typeof c.onResize?c.onResize.call(this,a,p):this.options.defaultOnResize.call(this,a,p)},onLayoutDone:function(){},fontSizeRatio:0.25,lineHeightRatio:1,updateFontSize:!0,margin:[0.05,0.05,0.05,0.05],padding:[0.05,0.05,0.05,0.05],blockShadow:0,ownWorker:!1,workerURL:null,preInit:function(){},postInit:function(){}};this.geometry={top:0,left:0,width:1,height:1,uWidth:1,uHeight:1};E?this.init():
V.push(this)}function e(a,c,d){3>arguments.length&&(d=/^(.*?)[^\/]*$/.exec(x)[1]+"res/sounds/");"/"!=d[d.length-1]&&(d+="/");L||(L=b("<div/>").hide().appendTo(b("body")));var e=L.find("[jblocks-sound="+a+"]");c?(0==e.length&&(e=b("<audio/>").attr("jblocks-sound",a).appendTo(L)),e.empty(),b("<source/>").attr("src",d+c+".ogg").attr("type","audio/ogg").appendTo("audio"),b("<source/>").attr("src",d+c+".mp3").attr("type","audio/mp3").appendTo("audio")):e.remove()}function l(b){if(L){var a=L.find("[jblocks-sound="+
b+"]");if(0<a.length){var a=a[0],c=null;"undefined"!=typeof device&&/iphone|ipad|ipod|ios/i.test(device.platform)&&(c="ios");"undefined"==typeof I&&(I=!1,"undefined"!=typeof device&&("Android"==device.platform&&"2"==device.version.charAt(0))&&(I=!0),"undefined"!=typeof device&&/iphone|ipad|ipod|ios/i.test(device.platform)&&(I=!0));if(I){"undefined"==typeof A&&(A={});if("undefined"==typeof A[b]){for(a=a.firstChild;a&&!(/source/i.test(a.nodeName)&&"audio/mp3"==a.getAttribute("type"));)a=a.nextSibling;
a?(a=a.getAttribute("src"),/^file:\/\//.test(a)&&(a=/^file:\/\/(.*)$/.exec(a)[1]),"ios"==c&&(a=a.replace(/^(\.\.\/)*/,"")),A[b]=new Media(a,function(){},function(){},function(){})):A[b]=null}A[b]&&A[b].play()}else a.cloneNode(!0).play()}}}function n(){R||(R=new c(null));R.options.ownWorker=!0;return R}function t(){for(var a=[],c=0;c<arguments.length;c++){var d=arguments[c];if("string"!=typeof d)try{d=JSON.stringify(d)}catch(e){d="<???>"}a.push(""+d)}a=a.join(" ");E?b(".jblocks-log").append(b("<p/>").text(a)):
m.push(a)}function u(b){for(var a in b)U[a]=b[a]}function k(b,a){2>arguments.length&&(a={});var c=U[b];if("undefined"==typeof c)c=b;else for(var d in a)c=c.replace(RegExp(d,"g"),a[d]);return c}function r(){if(!window.name)return null;var b=/^jblocks-data-([0-9]+)$/.exec(window.name);if(!b)return null;b=b[1];return!window.parent||!window.parent.$||!window.parent.$.jBlocks||!window.parent.$.jBlocks.frameData||!window.parent.$.jBlocks.frameData.data[b]?null:window.parent.$.jBlocks.frameData.data[b]}
function v(){try{var b=d[arguments[2]].extend(arguments[3]);return d[arguments[1]]=b}catch(a){alert("!!! "+a+"\n"+JSON.stringify(arguments))}}var s=function(){},g=!1,f=/xyz/.test(function(){})?/\b_super\b/:/.*/;s.extend=function(b){function a(b){!g&&this.init&&(0<arguments.length&&b.jBlocksArgsList?this.init.apply(this,b):this.init.apply(this,arguments))}var c=this.prototype;g=!0;var d=new this;g=!1;for(var e in b)d[e]="function"==typeof b[e]&&"function"==typeof c[e]&&f.test(b[e])?function(b,a){return function(){var p=
this._super;this._super=c[b];var d=a.apply(this,arguments);this._super=p;return d}}(e,b[e]):b[e];a.prototype=d;a.prototype.constructor=a;a.extend=arguments.callee;return a};var d={Class:s},h=0,m=[],q=0,j=(new Date).getTime(),x,s=document.getElementsByTagName("script");x=s[s.length-1].src;var J=null;c.prototype={};c.prototype.getWorker=function(){var c=this;if("undefined"==typeof Worker)return null;if(this.worker)return this.worker;this.options.ownWorker?this.worker=a(this.options.workerURL):(J||(J=
a(this.options.workerURL)),this.worker=J);b(document).bind("jblocks.worker",function(b,a){if(a.jBlocksIndex==c.jBlocksIndex)switch(a.cmd){case "layouts":c.layoutInProgress--;c.layoutCache[a.args.signature]={layouts:JSON.parse(JSON.stringify(a.args.layouts)),layoutData:JSON.parse(JSON.stringify(a.args.layoutData)),lastUsed:(new Date).getTime()};c.checkSanity(a.args.layouts,a.args.layoutData);c.layouts=a.args.layouts;c.layoutData=a.args.layoutData;for(var d in a.args.layouts){var e=a.args.layouts[d],
j=c.blocks[e.block.id];j&&!1==j.options.earlyLayout&&c.applyBlockLayout(e)}a.args.signature==c.layoutSign&&c.layoutDone();break;case "layout":d=a.args.layout.block.id,a.args.misfit?c.layoutData.misfits[d]=!0:delete c.layoutData.misfits[d],(j=c.blocks[d])&&j.options.earlyLayout&&c.applyBlockLayout(a.args.layout)}});return this.worker};c.prototype.init=function(){var a=this;null==this.anchor&&(this.anchor=b("body").first());this.options.preInit.call(this);this.anchor.data("jBlocks",this);this.anchor.empty();
this.fullscreenMethods=this.getFullscreenMethods();this.frame=b("<div/>").addClass("jblocks-frame").css({}).appendTo(this.anchor);this.frameContent=b("<div/>").addClass("jblocks-frame-content").css({}).appendTo(this.frame);for(var c in this.blocks)this.blocks[c].create(this.anchor);this.anchor.bind("jBlocks.resize",function(b,c){c||(c={width:a.anchor.width(),height:a.anchor.height()});a.jBlocksResizeTimer&&clearTimeout(a.jBlocksResizeTimer);a.jBlocksResizeTimer=setTimeout(function(){a.jBlocksResizeTimer=
null;var b=a.anchor.children(".jblocks-frame").children(".jblocks-frame-content");b.width(c.width);b.height(c.height);a.geometry.width=c.width;a.geometry.height=c.height;a.geometry.uWidth=a.geometry.width/a.viewport.w;a.geometry.uHeight=a.geometry.height/a.viewport.h;a.options.onResize.call(a,a.geometry,a.viewport);a.geometry.uWidth=a.geometry.width/a.viewport.w;a.geometry.uHeight=a.geometry.height/a.viewport.h;a.options.updateFontSize&&(b=Math.min(a.geometry.uHeight,a.geometry.uWidth),a.frameContent.css({"font-size":b*
a.options.fontSizeRatio+"pt"}));a.checkLayout()},a.options.resizeDelay);b.stopPropagation()});b(document).bind("jblocks.login",function(b,c){a.loggedIn=c;for(var d in a.blocks)a.blocks[d].onLoggedIn(c)});b(document).bind("jblocks.logout",function(){a.loggedIn=null;for(var b in a.blocks)a.blocks[b].onLoggedOut()});this.updateOptions({});this.checkLayout();this.options.postInit.call(this)};c.prototype.getSelf=function(){return this};c.prototype.newBlock=function(){if(!d[arguments[0]])throw"Unknown class "+
arguments[0];var b=d[arguments[0]],a=Array.prototype.slice.call(arguments,1);a.jBlocksArgsList=!0;b=new b(a);b.className=arguments[0];return b};c.prototype.addBlock=function(b){this.blocks[b.id]=b;b.jBlocks=this;E&&b.create(this.anchor);this.checkLayout()};c.prototype.addNewBlock=function(){var b=c.prototype.newBlock.apply(this,arguments);this.addBlock(b);return b};c.prototype.removeBlock=function(b){var a=this.blocks[b];a&&(a.onRemove(),delete this.blocks[b]);this.checkLayout()};c.prototype.blocksByTag=
function(b){var a=[],c;for(c in this.blocks){var d=this.blocks[c];d.tags[b]&&a.push(d)}return a};c.prototype.removeBlocksByTag=function(b){b=this.blocksByTag(b);for(var a in b)this.removeBlock(b[a].id)};c.prototype.removeAllBlocks=function(){for(var b in this.blocks)this.removeBlock(this.blocks[b].id)};c.prototype.updateViewport=function(a){b.extend(this.viewport,a);this.checkLayout()};c.prototype.updateOptions=function(a){b.extend(this.options,a);this.options.scrollable&&!this.scrollable&&this.makeScrollable();
!this.options.scrollable&&this.scrollable&&this.unmakeScrollable()};c.prototype.getLayoutSign=function(){var a={},c;for(c in this.blocks){var d=this.blocks[c];a[d.id]=d.layout}return b.jBlocks.util.md5(JSON.stringify({_1:a,_2:this.viewport}))};c.prototype.applyBlockLayout=function(a){var c=this.blocks[a.block.id];if("undefined"==typeof c)b.jBlocks("log","Unknown block id",a.block.id),this.anchor.find("#jblocks-block-"+this.jBlocksIndex+"-"+a.block.id).hide();else if(c.actualLayout=a,!1==c.layout.visible||
this.layoutData.misfits[c.id])c.anchor.hide();else{c.anchor.show();var d=c.anchor.position(),e=c.anchor.width(),j=c.anchor.height(),g=d.top,d=d.left,f={width:Math.round(a.w*this.geometry.uWidth),height:Math.round(a.h*this.geometry.uHeight),left:Math.round(a.c*this.geometry.uWidth),top:Math.round(a.r*this.geometry.uHeight)};e!=f.width||j!=f.height?(a=c.getContentGeometry(f,this.geometry.uWidth,this.geometry.uHeight),c.onStartResize(a,f),a.top=f.top,a.left=f.left,c.anchor.stop().animate(a,this.options.resizeAnimateDelay,
function(){c.content.show();c.onResize(f)})):(d!=f.left||g!=f.top)&&c.anchor.stop().animate({left:Math.round(a.c*this.geometry.uWidth),top:Math.round(a.r*this.geometry.uHeight)},this.options.resizeAnimateDelay,function(){})}};c.prototype.applyLayout=function(){for(var b in this.layoutData.misfits)if(this.layoutData.misfits[b]){var a=this.blocks[b];a&&a.anchor.hide()}for(var c in this.layouts)this.applyBlockLayout(this.layouts[c])};c.prototype.layoutDone=function(){var a=this.jBlocksIndex+": "+(this.layoutInProgress+
1)+" "+ ++this.layoutCount+" "+this.viewport.w+"x"+this.viewport.h+" ("+this.layoutData.maxSize.w+"x"+this.layoutData.maxSize.h+") "+((new Date).getTime()-this.layoutStatsT0)+"ms";this.options.debug&&(b("head title").text(a),t(a));"height"==this.viewport.fixed||"both"==this.viewport.fixed?this.viewport.r=0:this.viewport.h+this.viewport.r>this.layoutData.maxSize.h&&this.layoutData.maxSize.h-this.viewport.h&&(this.viewport.r=Math.max(0,this.layoutData.maxSize.h-this.viewport.h));"width"==this.viewport.fixed||
"both"==this.viewport.fixed?this.viewport.c=0:this.viewport.w+this.viewport.c>this.layoutData.maxSize.w&&this.layoutData.maxSize.w-this.viewport.w&&(this.viewport.c=Math.max(0,this.layoutData.maxSize.w-this.viewport.w));if(this.focusedBlockId&&(a=this.blocks[this.focusedBlockId])){var a=a.actualLayout,c=this.viewport.r,d=this.viewport.c;a.r+a.h>this.viewport.r+this.viewport.h?this.viewport.r=Math.max(a.r+a.h-this.viewport.h,0):a.r<this.viewport.r&&(this.viewport.r=a.r);a.c+a.w>this.viewport.c+this.viewport.w?
this.viewport.c=Math.max(a.c+a.w-this.viewport.w,0):a.c<this.viewport.c&&(this.viewport.c=a.c);if(this.viewport.r!=c||this.viewport.c!=d)a={top:-this.viewport.r*this.geometry.uHeight,left:-this.viewport.c*this.geometry.uWidth},this.frameContent.stop().animate(a,this.options.scrollAnimateDelay)}this.frameContent.stop().animate({top:-this.viewport.r*this.geometry.uHeight,left:-this.viewport.c*this.geometry.uWidth},this.options.scrollAnimateDelay);this.focusedBlockId=null;this.options.onLayoutDone.call(this)};
c.prototype.focusBlockId=function(a){this.focusedBlockId=a};c.prototype.checkSanity=function(a,b){var c=[],d={},e;for(e in a){var j=a[e];d[j.block.id]=!0;b.misfits[j.block.id]&&alert("in both layouts and misfit "+j.block.id);j.block.visible&&!b.misfits[j.block.id]&&c.push(j)}for(e in c){var j=c[e],g;for(g in c){var f=c[g];e!=g&&(f.r<j.r+j.h&&f.r+f.h>j.r&&f.c<j.c+j.w&&f.c+f.w>j.c)&&alert("mismatch "+j.block.id+" "+f.block.id+" "+JSON.stringify(j)+" "+JSON.stringify(f))}}for(var h in this.blocks)c=
this.blocks[h],!d[c.id]&&!b.misfits[c.id]&&t("missing block "+c.id)};c.prototype.rebuild=function(){if(!(0==this.viewport.h||0==this.viewport.w)){this.layoutStatsT0=(new Date).getTime();if(0==this.layoutInProgress){var a=this.layoutCache[this.layoutSign];if(a){this.checkSanity(a.layouts,a.layoutData);a.lastUsed=(new Date).getTime();this.layoutData=JSON.parse(JSON.stringify(a.layoutData));this.layouts=JSON.parse(JSON.stringify(a.layouts));this.applyLayout();this.layoutDone();return}}var a=[],c;for(c in this.blocks){var d=
this.blocks[c];if(d.anchor){var e={id:c};b.extend(e,d.layout);a.push(e)}}if(c=this.getWorker())this.layoutInProgress++,c.postMessage({cmd:"layout",args:{blocks:a,viewport:this.viewport,signature:this.layoutSign},jBlocksIndex:this.jBlocksIndex});else try{b.jBlocks("log","workerless layout");var j=b.jBlocks.worker.layout(a,this.viewport,this.layoutData);b.jBlocks("log","workerless layout done");this.layouts=j;this.applyLayout();this.layoutDone()}catch(f){alert("Workerless exception: "+f+" "+f.sourceURL+
":"+f.line)}}};c.prototype.doCheckLayout=function(){for(var a in this.blocks){var c=this.blocks[a];"function"==typeof c.options.w&&(c.layout.w=Math.max(1,c.options.w.call(c,this.viewport)));"function"==typeof c.options.h&&(c.layout.h=Math.max(1,c.options.h.call(c,this.viewport)))}a=this.getLayoutSign();a==this.layoutSign?null!=this.layouts&&(a=b.jBlocks.util.md5(JSON.stringify({_1:this.geometry.uWidth,_2:this.geometry.uHeight})),0==this.layoutInProgress&&a!=this.geometrySizeSign&&(this.geometrySizeSign=
a,this.applyLayout())):(this.layoutSign=a,this.rebuild())};c.prototype.checkLayout=function(){if(E){var a=this;this.jBlocksLayoutTimer&&clearTimeout(this.jBlocksLayoutTimer);this.jBlocksLayoutTimer=setTimeout(function(){this.jBlocksLayoutTimer=null;a.doCheckLayout()},this.options.layoutDelay)}};c.prototype.makeScrollable=function(){function a(c,d){var e,j,f,g,h,l;2>arguments.length&&(d=1);switch(c){case "down":e="r";j="h";f="top";g="uHeight";h="rows";l=1;break;case "up":e="r";j="h";f="top";g="uHeight";
h="rows";l=-1;break;case "right":e="c";j="w";f="left";g="uWidth";h="cols";l=1;break;case "left":e="c",j="w",f="left",g="uWidth",h="cols",l=-1}for(var m=Math.ceil(d/b.geometry[g]),x=b.viewport[e];Math.abs(x-b.viewport[e])<m;){var k=-1,J;for(J in b.layoutData.rmk[h]){var p=b.layoutData.rmk[h][J];if((0<l&&p>b.viewport[e]||0>l&&p<b.viewport[e])&&(0>l||p+b.viewport[j]<=b.layoutData.maxSize[j])&&(0>k||0<l&&p<k||0>l&&p>k))k=p}if(0<=k)b.viewport[e]=k,p={},p[f]=-k*b.geometry[g],b.frameContent.stop().animate(p,
b.options.scrollAnimateDelay);else break}}if(E){var b=this;this.anchor.bind("mousewheel DOMMouseScroll",function(c){var d;if(c.detail)d=0>c.detail?1:-1;else if(c.wheelDelta)d=0<c.wheelDelta?1:-1;else if(c.originalEvent)if(c.originalEvent.wheelDelta)d=0<c.originalEvent.wheelDelta?1:-1;else if(c.originalEvent.detail)d=0>c.originalEvent.detail?1:-1;else return;else return;c.ctrlKey||("width"==b.viewport.fixed?0>d?a("down"):a("up"):"height"==b.viewport.fixed&&(0>d?a("right"):a("left")));c.stopPropagation()});
var c,d;this.anchor.swipe({swipeLeft:function(b,c,d){a("right",d);b.stopPropagation()},swipeRight:function(b,c,d){a("left",d);b.stopPropagation()},swipeUp:function(b,c,d){a("down",d);b.stopPropagation()},swipeDown:function(b,c,d){a("up",d);b.stopPropagation()},swipeStatus:function(a,e,j,f){switch(e){case "start":c=parseInt(b.frameContent.css("top"));d=parseInt(b.frameContent.css("left"));break;case "cancel":b.frameContent.css({top:c,left:d});break;case "move":"width"==b.viewport.fixed?"down"==j?b.frameContent.css("top",
Math.min(0,c+f)):"up"==j&&b.frameContent.css("top",Math.min(c-f,b.anchor.height()-b.frameContent.height())):"height"==b.viewport.fixed&&("left"==j?b.frameContent.css("left",Math.max(d-f,b.anchor.width()-b.layoutData.maxSize.w*b.geometry.uWidth)):"right"==j&&b.frameContent.css("left",Math.min(0,d+f)))}}});this.scrollable=!0}};c.prototype.unmakeScrollable=function(){this.anchor.swipe("destroy");this.anchor.unbind("mousewheel DOMMouseScroll")};c.prototype.updateViewportFromGeometry=function(a,c,d){var e=
{pixels:150,minw:6,maxw:15,minh:7,maxh:12};2<arguments.length&&b.extend(e,d);c.w=Math.round(a.width/e.pixels);c.w<e.minw&&(c.w=e.minw);c.w>e.maxw&&(c.w=e.maxw);c.h=Math.round(a.height/e.pixels);c.h<e.minh&&(c.h=e.minh);c.h>e.maxh&&(c.h=e.maxh)};c.prototype.getFullscreenMethods=function(){var a=["","moz","webkit","o","ms"],b=null,c;for(c in a){var d=a[c],e=(d+"RequestFullScreen").substr(0,1).toLowerCase()+(d+"RequestFullScreen").substr(1);if("function"==typeof this.anchor[0][e]){b={request:e,event:d+
"fullscreenchange",element:(d+"FullScreenElement").substr(0,1).toLowerCase()+(d+"FullScreenElement").substr(1)};switch(d){case "webkit":b.element="webkitCurrentFullScreenElement"}break}}return b};c.prototype.pushLayout=function(){var a={},b;for(b in this.blocks)a[this.blocks[b].id]=JSON.parse(JSON.stringify(this.blocks[b].layout));this.layoutsStack.push(a)};c.prototype.popLayout=function(){var a=this.layoutsStack.pop(),b;for(b in a){var c=a[b],d=this.blocks[b];d&&(d.layout=c)}};c.prototype.hideAllBlocks=
function(){for(var a in this.blocks)this.blocks[a].layout.visible=!1};c.prototype.updateSize=function(){this.anchor.trigger("jBlocks.resize",{width:this.anchor.width(),height:this.anchor.height()})};c.prototype.canFullscreen=function(){return null!=this.fullscreenMethods};c.prototype.fullscreen=function(a,c){if(0==arguments.length||!a)a=this.anchor;2>arguments.length&&(c=function(){});var d=this.fullscreenMethods;if(d){var e=document[d.element],j=a.width(),f=a.height();b(document).bind(d.event,function(){setTimeout(function(){var g,
h,l;document[d.element]?(l=!0,a.addClass("jblocks-full-size"),g=document[d.element].offsetWidth,h=document[d.element].offsetHeight,b.jBlocks("log","entered fullScreen",g,"x",h)):(l=!1,a.removeClass("jblocks-full-size"),g=j,h=f,b(document).unbind(d.event),b.jBlocks("log","exited fullScreen",g,"x",h));e&&(e.width(g),e.height(h));c(l)},0)});a[0][d.request]()}};var V=[],M=[],E=!1;b(document).ready(function(){if(!E){E=!0;for(var a in m)b.jBlocks("log",m[a]);m=[];for(a in V)V[a].init();V=null;for(a in M){var c=
M[a];c[0].apply(c[1],c[2])}M=null}});var L=null,I,A,P=null,R=null,U={};b.jBlocks=function(a){switch(a){case "defineBlockClass":return v.apply(null,arguments);case "autoSyncContentSize":var d=function(){b("body").trigger("jBlocks.resize",{width:b("body").width(),height:b("body").height()})};b(window).bind("orientationchange resize",function(){d()});b(document).ready(function(){d()});break;case "log":var f=Array.prototype.slice.call(arguments,1);t.apply(n(),[(new Date).getTime()-j].concat(f));break;
case "addTranslation":return f=Array.prototype.slice.call(arguments,1),u.apply(null,f);case "translate":return f=Array.prototype.slice.call(arguments,1),k.apply(null,f);case "getFrameData":return Array.prototype.slice.call(arguments,1),r.call(null);case "addSound":f=Array.prototype.slice.call(arguments,1);E?e.apply(null,f):M.push([e,null,f]);break;case "playSound":f=Array.prototype.slice.call(arguments,1);E?l.apply(null,f):M.push([l,null,f]);break;case "click":return P||(P="click","ontouchstart"in
document.documentElement&&(P="jblocks.click")),P;case "getBlockAnonIndex":return q++;default:if("function"!=typeof c.prototype[a])throw"jBlocks: no such method "+a;var g=n(),f=Array.prototype.slice.call(arguments,1);return c.prototype[a].apply(g,f)}};b.fn.jBlocks=function(){var a=this.first(),b=new c(a);b.anchor=a;b.init();b.updateSize();return b};if("ontouchstart"in document.documentElement){var S=0,K;b(document).bind("touchstart",function(a){S=(new Date).getTime();K=a.target});b(document).bind("touchend",
function(){S&&(200>(new Date).getTime()-S&&b(K).trigger("jblocks.click"),K=null)});b(document).bind("touchcancel",function(){S=0;K=null})}})(jQuery);
(function(b){b.jBlocks.util={md5:function(a){function b(a,c){var d,e,f,g,h;f=a&2147483648;g=c&2147483648;d=a&1073741824;e=c&1073741824;h=(a&1073741823)+(c&1073741823);return d&e?h^2147483648^f^g:d|e?h&1073741824?h^3221225472^f^g:h^1073741824^f^g:h^f^g}function e(a,d,e,f,g,h,l){a=b(a,b(b(d&e|~d&f,g),l));return b(a<<h|a>>>32-h,d)}function l(a,d,e,f,g,h,l){a=b(a,b(b(d&f|e&~f,g),l));return b(a<<h|a>>>32-h,d)}function n(a,d,e,f,g,h,l){a=b(a,b(b(d^e^f,g),l));return b(a<<h|a>>>32-h,d)}function t(a,d,e,f,
g,h,l){a=b(a,b(b(e^(d|~f),g),l));return b(a<<h|a>>>32-h,d)}function u(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var k=[],r,v,s,g,f,d,h,m,k=a.replace(/\r\n/g,"\n");a="";for(r=0;r<k.length;r++)v=k.charCodeAt(r),128>v?a+=String.fromCharCode(v):(127<v&&2048>v?a+=String.fromCharCode(v>>6|192):(a+=String.fromCharCode(v>>12|224),a+=String.fromCharCode(v>>6&63|128)),a+=String.fromCharCode(v&63|128));k=a;a=k.length;r=a+8;v=16*((r-r%64)/64+1);
s=Array(v-1);for(f=g=0;f<a;)r=(f-f%4)/4,g=8*(f%4),s[r]|=k.charCodeAt(f)<<g,f++;r=(f-f%4)/4;s[r]|=128<<8*(f%4);s[v-2]=a<<3;s[v-1]=a>>>29;k=s;f=1732584193;d=4023233417;h=2562383102;m=271733878;for(a=0;a<k.length;a+=16)r=f,v=d,s=h,g=m,f=e(f,d,h,m,k[a+0],7,3614090360),m=e(m,f,d,h,k[a+1],12,3905402710),h=e(h,m,f,d,k[a+2],17,606105819),d=e(d,h,m,f,k[a+3],22,3250441966),f=e(f,d,h,m,k[a+4],7,4118548399),m=e(m,f,d,h,k[a+5],12,1200080426),h=e(h,m,f,d,k[a+6],17,2821735955),d=e(d,h,m,f,k[a+7],22,4249261313),
f=e(f,d,h,m,k[a+8],7,1770035416),m=e(m,f,d,h,k[a+9],12,2336552879),h=e(h,m,f,d,k[a+10],17,4294925233),d=e(d,h,m,f,k[a+11],22,2304563134),f=e(f,d,h,m,k[a+12],7,1804603682),m=e(m,f,d,h,k[a+13],12,4254626195),h=e(h,m,f,d,k[a+14],17,2792965006),d=e(d,h,m,f,k[a+15],22,1236535329),f=l(f,d,h,m,k[a+1],5,4129170786),m=l(m,f,d,h,k[a+6],9,3225465664),h=l(h,m,f,d,k[a+11],14,643717713),d=l(d,h,m,f,k[a+0],20,3921069994),f=l(f,d,h,m,k[a+5],5,3593408605),m=l(m,f,d,h,k[a+10],9,38016083),h=l(h,m,f,d,k[a+15],14,3634488961),
d=l(d,h,m,f,k[a+4],20,3889429448),f=l(f,d,h,m,k[a+9],5,568446438),m=l(m,f,d,h,k[a+14],9,3275163606),h=l(h,m,f,d,k[a+3],14,4107603335),d=l(d,h,m,f,k[a+8],20,1163531501),f=l(f,d,h,m,k[a+13],5,2850285829),m=l(m,f,d,h,k[a+2],9,4243563512),h=l(h,m,f,d,k[a+7],14,1735328473),d=l(d,h,m,f,k[a+12],20,2368359562),f=n(f,d,h,m,k[a+5],4,4294588738),m=n(m,f,d,h,k[a+8],11,2272392833),h=n(h,m,f,d,k[a+11],16,1839030562),d=n(d,h,m,f,k[a+14],23,4259657740),f=n(f,d,h,m,k[a+1],4,2763975236),m=n(m,f,d,h,k[a+4],11,1272893353),
h=n(h,m,f,d,k[a+7],16,4139469664),d=n(d,h,m,f,k[a+10],23,3200236656),f=n(f,d,h,m,k[a+13],4,681279174),m=n(m,f,d,h,k[a+0],11,3936430074),h=n(h,m,f,d,k[a+3],16,3572445317),d=n(d,h,m,f,k[a+6],23,76029189),f=n(f,d,h,m,k[a+9],4,3654602809),m=n(m,f,d,h,k[a+12],11,3873151461),h=n(h,m,f,d,k[a+15],16,530742520),d=n(d,h,m,f,k[a+2],23,3299628645),f=t(f,d,h,m,k[a+0],6,4096336452),m=t(m,f,d,h,k[a+7],10,1126891415),h=t(h,m,f,d,k[a+14],15,2878612391),d=t(d,h,m,f,k[a+5],21,4237533241),f=t(f,d,h,m,k[a+12],6,1700485571),
m=t(m,f,d,h,k[a+3],10,2399980690),h=t(h,m,f,d,k[a+10],15,4293915773),d=t(d,h,m,f,k[a+1],21,2240044497),f=t(f,d,h,m,k[a+8],6,1873313359),m=t(m,f,d,h,k[a+15],10,4264355552),h=t(h,m,f,d,k[a+6],15,2734768916),d=t(d,h,m,f,k[a+13],21,1309151649),f=t(f,d,h,m,k[a+4],6,4149444226),m=t(m,f,d,h,k[a+11],10,3174756917),h=t(h,m,f,d,k[a+2],15,718787259),d=t(d,h,m,f,k[a+9],21,3951481745),f=b(f,r),d=b(d,v),h=b(h,s),m=b(m,g);return(u(f)+u(d)+u(h)+u(m)).toLowerCase()},sha1:function(a){function b(a,c){return a<<c|a>>>
32-c}function e(a){var b="",c,d;for(c=7;0<=c;c--)d=a>>>4*c&15,b+=d.toString(16);return b}var l,n,t=Array(80),u=1732584193,k=4023233417,r=2562383102,v=271733878,s=3285377520,g,f,d,h,m;l=a.replace(/\r\n/g,"\n");var q="";for(a=0;a<l.length;a++)n=l.charCodeAt(a),128>n?q+=String.fromCharCode(n):(127<n&&2048>n?q+=String.fromCharCode(n>>6|192):(q+=String.fromCharCode(n>>12|224),q+=String.fromCharCode(n>>6&63|128)),q+=String.fromCharCode(n&63|128));a=q;g=a.length;q=[];for(l=0;l<g-3;l+=4)n=a.charCodeAt(l)<<
24|a.charCodeAt(l+1)<<16|a.charCodeAt(l+2)<<8|a.charCodeAt(l+3),q.push(n);switch(g%4){case 0:l=2147483648;break;case 1:l=a.charCodeAt(g-1)<<24|8388608;break;case 2:l=a.charCodeAt(g-2)<<24|a.charCodeAt(g-1)<<16|32768;break;case 3:l=a.charCodeAt(g-3)<<24|a.charCodeAt(g-2)<<16|a.charCodeAt(g-1)<<8|128}for(q.push(l);14!=q.length%16;)q.push(0);q.push(g>>>29);q.push(g<<3&4294967295);for(a=0;a<q.length;a+=16){for(l=0;16>l;l++)t[l]=q[a+l];for(l=16;79>=l;l++)t[l]=b(t[l-3]^t[l-8]^t[l-14]^t[l-16],1);n=u;g=k;
f=r;d=v;h=s;for(l=0;19>=l;l++)m=b(n,5)+(g&f|~g&d)+h+t[l]+1518500249&4294967295,h=d,d=f,f=b(g,30),g=n,n=m;for(l=20;39>=l;l++)m=b(n,5)+(g^f^d)+h+t[l]+1859775393&4294967295,h=d,d=f,f=b(g,30),g=n,n=m;for(l=40;59>=l;l++)m=b(n,5)+(g&f|g&d|f&d)+h+t[l]+2400959708&4294967295,h=d,d=f,f=b(g,30),g=n,n=m;for(l=60;79>=l;l++)m=b(n,5)+(g^f^d)+h+t[l]+3395469782&4294967295,h=d,d=f,f=b(g,30),g=n,n=m;u=u+n&4294967295;k=k+g&4294967295;r=r+f&4294967295;v=v+d&4294967295;s=s+h&4294967295}m=e(u)+e(k)+e(r)+e(v)+e(s);return m.toLowerCase()}}})(jQuery);
"undefined"==typeof $&&($={});"undefined"==typeof $.jBlocks&&($.jBlocks={});
$.jBlocks.worker={supported:!1,log:function(){if($.jBlocks.worker.supported){for(var b=[],a=0;a<arguments.length;a++){var c=arguments[a];"string"!=typeof c&&(c=JSON.stringify(c));b.push(""+c)}self.postMessage({cmd:"log",args:{str:b.join(" ")}})}else $.jBlocks.apply(["log"].concat(arguments))},extend:function(b){for(var a=1;a<arguments.length;a++){var c=arguments[a],e;for(e in c)b[e]=c[e]}},layout:function(b,a,c,e){function l(b){var d=[],e;for(e in c.rmk.rows)for(var f in c.rmk.cols)d.push({r:c.rmk.rows[e],
c:c.rmk.cols[f]}),b&&("width"==a.fixed&&d.push({r:c.rmk.rows[e]+b.h,c:c.rmk.cols[f]}),"height"==a.fixed&&d.push({r:c.rmk.rows[e],c:c.rmk.cols[f]+b.w}));b=[];e={};for(f=0;f<d.length-1;f++)for(var g=f+1;g<d.length;g++){var h=d[f],j=d[g];h.r!=j.r&&h.c!=j.c&&(h={r:Math.min(h.r,j.r),c:Math.min(h.c,j.c),h:Math.abs(j.r-h.r),w:Math.abs(j.c-h.c)},j=h.c+","+h.r+"-"+h.w+"x"+h.h,e[j]||(e[j]=!0,b.push(h)))}return b}b.sort(function(a,b){return b.priority-a.priority});c.rmk.rows={"0":0};c.rmk.rows[a.h]=a.h;c.rmk.cols=
{"0":0};c.rmk.cols[a.w]=a.w;c.misfits={};for(var n=[],t=[],u={w:-1,h:-1};0<b.length;){var k=b.shift();if(k.visible){for(var r=l(k),v=[],s=0;s<r.length;s++){var g=r[s];if(k.w<=g.w&&k.h<=g.h){for(var f=!0,d=0;d<n.length&&f;d++)if(j=n[d],!(j.r+j.block.h<=g.r||j.r>=g.r+g.h||j.c+j.block.w<=g.c||j.c>=g.c+g.w)){f=!1;break}f&&v.push(g)}}j=k.pref;if(!k.pref||"default"==k.pref)j="height"==a.fixed?"left top":"top left";var g=null,h=function(b,c){return b.r<a.h&&c.r>=a.h?-1:c.r<a.h&&b.r>=a.h?1:Math.abs(b.r+b.h-
a.h)-Math.abs(c.r+c.h-a.h)},m=function(b,c){return Math.abs(b.c+b.w-a.w)-Math.abs(c.c+c.w-a.w)},q=function(a,b){return a.w*a.h-b.w*b.h};switch(j){case "top right":g=function(a,b){return a.r-b.r||m(a,b)||q(a,b)};break;case "right top":g=function(a,b){return m(a,b)||a.r-b.r||q(a,b)};break;case "bottom left":g=function(a,b){return h(a,b)||a.c-b.c||q(a,b)};break;case "left bottom":g=function(a,b){return a.c-b.c||h(a,b)||q(a,b)};break;case "bottom right":g=function(a,b){return h(a,b)||m(a,b)||q(a,b)};
break;case "right bottom":g=function(a,b){return m(a,b)||h(a,b)||q(a,b)};break;case "left top":g=function(a,b){return a.c-b.c||a.r-b.r||q(a,b)};break;case "top left":g=function(a,b){return a.r-b.r||a.c-b.c||q(a,b)};break;case "center":g=function(b,c){var d=Math.min(b.c+b.w,a.w)-b.c,e=Math.min(b.r+b.h,a.h)-b.r,f=Math.min(c.c+c.w,a.w)-c.c,g=Math.min(c.r+c.h,a.h)-c.r;return f*g-d*e};break;default:$jBlocks("log","Unknown block.pref",k.pref)}v.sort(g);if(0==v.length){g=0;for(r=n.length-1;0<=r;r--)j=n[r],
j.block.importance<k.importance&&($.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:{block:j.block},misfit:!0},jBlocksIndex:e}),c.misfits[j.block.id]=!0,b.unshift(j.block),n.splice(r,1),g++);0==g?(c.misfits[k.id]=!0,$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:{block:k},misfit:!0},jBlocksIndex:e})):b.unshift(k)}else{r="left";s="top";k.pref&&(0<=k.pref.indexOf("right")&&(r="right"),0<=k.pref.indexOf("bottom")&&(s="bottom"),0<=k.pref.indexOf("center")&&
(r=s="center"));g=v[0];j={r:"top"==s?g.r:g.r+g.h-k.h,c:"left"==r?g.c:g.c+g.w-k.w,h:k.h,w:k.w,block:k};switch(s){case "top":j.r=g.r;break;case "bottom":j.r=g.r+g.h-k.h;break;case "center":j.r=g.r+Math.floor((g.h-k.h)/2)}switch(r){case "left":j.c=g.c;break;case "right":j.c=g.c+g.w-k.w;break;case "center":j.c=g.c+Math.floor((g.w-k.w)/2)}c.rmk.rows[j.r]=j.r;c.rmk.rows[j.r+j.block.h]=j.r+j.block.h;c.rmk.cols[j.c]=j.c;c.rmk.cols[j.c+j.block.w]=j.c+j.block.w;delete c.misfits[j.block.id];$.jBlocks.worker.supported&&
self.postMessage({cmd:"layout",args:{layout:j,misfit:!1},jBlocksIndex:e});n.push(j);if(0>u.w||j.c+j.block.w>u.w)u.w=j.c+j.block.w;if(0>u.h||j.r+j.block.h>u.h)u.h=j.r+j.block.h}}else{var j={block:k,visible:!1};t.push(j);$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:j,misfit:!1},jBlocksIndex:e})}}a.frameSize=u;c.maxSize={w:0,h:0};for(d=0;d<n.length;d++)j=n[d],c.maxSize.h<j.r+j.h&&(c.maxSize.h=j.r+j.h),c.maxSize.w<j.c+j.w&&(c.maxSize.w=j.c+j.w);c.rmk.rows={"0":0};c.rmk.rows[a.h]=
a.h;c.rmk.cols={"0":0};c.rmk.cols[a.w]=a.w;for(d=0;d<n.length;d++)j=n[d],c.rmk.rows[j.r]=j.r,c.rmk.rows[j.r+j.h]=j.r+j.h,c.rmk.cols[j.c]=j.c,c.rmk.cols[j.c+j.w]=j.c+j.w;c.maxSize.h>a.h&&(c.rmk.rows[c.maxSize.h-a.h]=c.maxSize.h-a.h);c.maxSize.w>a.w&&(c.rmk.cols[c.maxSize.w-a.w]=c.maxSize.w-a.w);if(a.fillHoles){r=l(null);r.sort(function(a,b){return b.w*b.h-a.w*a.h});for(b=!0;b;){b=!1;for(s=0;s<r.length&&!b;s++){g=r[s];u=!0;for(d=0;d<n.length&&u;d++)if(j=n[d],!(j.r+j.h<=g.r||j.r>=g.r+g.h||j.c+j.w<=g.c||
j.c>=g.c+g.w)){u=!1;break}if(u&&(g.c+g.w<=c.maxSize.w||g.c+g.w<=a.w)&&(g.r+g.h<=c.maxSize.h||g.r+g.h<=a.h)){u=[];for(d=0;d<n.length;d++)j=n[d],c.misfits[j.block.id]||(0<j.block.expandWidth&&(j.r>=g.r&&j.r+j.h<=g.r+g.h)&&(j.c+j.w==g.c&&u.push({li:d,change:{w:j.w+g.w},weight:"expandWidth"}),g.c+g.w==j.c&&u.push({li:d,change:{c:j.c-g.w,w:j.w+g.w},weight:"expandWidth"})),0<j.block.expandHeight&&(j.c>=g.c&&j.c+j.w<=g.c+g.w)&&(j.r+j.h==g.r&&u.push({li:d,change:{h:j.h+g.h},weight:"expandHeight"}),g.r+g.h==
j.r&&u.push({li:d,change:{r:j.r-g.h,h:j.h+g.h},weight:"expandHeight"})));0<u.length&&(b=!0,u.sort(function(a,b){return n[b.li].block[b.weight]-n[a.li].block[a.weight]}),u=u[0],j=n[u.li],$.jBlocks.worker.extend(j,u.change),$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:j,misfit:!1},jBlocksIndex:e}))}}}}return n.concat(t)}};
self&&"function"==typeof self.addEventListener&&self.addEventListener("message",function(b){if(b.data&&b.data.cmd)try{var a=b.data;switch(a.cmd){case "layout":$.jBlocks.worker.supported=!0;b={rmk:{rows:{},cols:{}},maxSize:{w:1,h:1}};var c=$.jBlocks.worker.layout(a.args.blocks,a.args.viewport,b,a.jBlocksIndex);self.postMessage({cmd:"layouts",args:{layouts:c,layoutData:b,signature:a.args.signature},jBlocksIndex:a.jBlocksIndex})}}catch(e){$.jBlocks.worker.log("Error "+a.cmd+": "+e)}},!1);
$.jBlocks("defineBlockClass","Block","Class",{init:function(b,a){2>arguments.length&&(a={});1>arguments.length&&(b={});this.id=a.id?a.id:"anon-"+$.jBlocks("getBlockAnonIndex");this.layout={priority:0,importance:0,w:1,h:1,pref:"default",visible:!0,expandWidth:1,expandHeight:1};this.actualLayout={w:1,h:1};$.extend(this.layout,b);this.maximized=!1;this.jBlocks=null;this.className="Block";this.options={blockClass:null,blockContentClass:null,margin:null,padding:null,borderRadius:0.07,contentBorderRadius:0,
capture:!1,maximizable:!0,requireAuth:!1,requireAnon:!1,autoFit:!1,debugBlockLayout:!1,onCreate:function(){},onRemove:function(){},onResize:function(){},onStartResize:function(){},tooltip:null,earlyLayout:!0};this.tags={};$.extend(this.options,a);this.options.requireAuth&&null==$.jBlocks.loggedIn&&(this.layout.visible=!1);this.options.requireAnon&&null!=$.jBlocks.loggedIn&&(this.layout.visible=!1)},create:function(b){this.options.layouts&&("undefined"==typeof this.options.layoutIndex&&(this.options.layoutIndex=
Math.floor((this.options.layouts.length-1)/2)),this.options.w=function(b){var c=a.options.layouts[a.options.layoutIndex];switch(typeof c.w){case "number":return c.w;case "function":return c.w.call(a,b);default:return a.layout.w}},this.options.h=function(b){var c=a.options.layouts[a.options.layoutIndex];switch(typeof c.h){case "number":return c.h;case "function":return c.h.call(a,b);default:return a.layout.h}});var a=this,c=this.options.blockClass||this.jBlocks.options.blockClass;this.anchor=$("<div/>").appendTo(b.children(".jblocks-frame").children(".jblocks-frame-content"));
this.anchor.addClass("jblocks-block").addClass("jblocks-"+this.jBlocks.jBlocksIndex).attr("id","jblocks-block-"+this.jBlocks.jBlocksIndex+"-"+this.id).css({top:$("body").height()/2,left:$("body").width()/2,width:1,height:1});c&&this.anchor.addClass(c);(this.options.debugBlockLayout||this.jBlocks.options.debugBlockLayout)&&this.anchor.bind("mouseover",function(b){$("head title").text(a.className+" "+JSON.stringify(a.layout));b.stopPropagation()});this.captMask=$("<div/>").addClass("jblocks-block-mask").appendTo(this.anchor);
b=this.options.blockContentClass||this.jBlocks.options.blockContentClass;this.content=$("<div/>").addClass("jblocks-block-content").appendTo(this.anchor);b&&this.content.addClass(b);this.options.tooltip&&this.content.attr("title",this.options.tooltip);this.onCreate();this.options.onCreate.call(this)},onRemove:function(){this.anchor&&this.anchor.remove();this.options.onRemove()},remove:function(){this.jBlocks.removeBlock(this.id)},canGrow:function(){return this.options.layouts&&this.options.layoutIndex<
this.options.layouts.length-1},grow:function(){this.canGrow()&&(this.options.layoutIndex++,this.jBlocks.checkLayout(),this.focus())},canShrink:function(){return this.options.layouts&&0<this.options.layoutIndex},shrink:function(){this.canShrink()&&(this.options.layoutIndex--,this.jBlocks.checkLayout(),this.focus())},focus:function(){this.jBlocks.focusBlockId(this.id)},addTag:function(b){this.tags[b]=!0},maximize:function(){!this.maximized&&this.options.maximizable&&($.extend(options,options0),this.jBlocks.pushLayout(),
this.jBlocks.hideAllBlocks(),this.layout.visible=!0,this.layout.w=this.jBlocks.viewport.w,this.layout.h=this.jBlocks.viewport.h,this.jBlocks.checkLayout(),this.maximized=!0)},unMaximize:function(){this.maximized&&(this.jBlocks.popLayout(),this.maximized=!1,this.jBlocks.checkLayout())},onCreate:function(){},onStartResize:function(b){this.options.onStartResize.call(this,b)},getContentGeometry:function(b,a,c){a=Math.min(a,c);c=this.jBlocks.options.margin;this.options.margin&&(c=this.options.margin);
var e=this.jBlocks.options.padding;this.options.padding&&(e=this.options.padding);var l={"margin-top":a*c[0],"margin-bottom":a*c[2],"margin-left":a*c[3],"margin-right":a*c[1],"padding-top":a*e[0],"padding-bottom":a*e[2],"padding-left":a*e[3],"padding-right":a*e[1],"border-left":parseInt(this.anchor.css("border-left-width")),"border-right":parseInt(this.anchor.css("border-right-width")),"border-top":parseInt(this.anchor.css("border-top-width")),"border-bottom":parseInt(this.anchor.css("border-bottom-width"))};
return{spacing:l,sizeRef:a,width:b.width-(c[1]+c[3])*a-(e[1]+e[3])*a-l["border-left"]-l["border-right"],height:b.height-(c[0]+c[2])*a-(e[0]+e[2])*a-l["border-right"]-l["border-bottom"]}},onResize:function(b){b=this.getContentGeometry(b,this.jBlocks.geometry.uWidth,this.jBlocks.geometry.uHeight);this.content.width(b.width);this.content.height(b.height);this.content.css("border-radius",b.sizeRef*this.options.contentBorderRadius+"px");this.anchor.css({"margin-top":b.spacing["margin-top"]+"px","margin-bottom":b.spacing["margin-bottom"]+
"px","margin-left":b.spacing["margin-left"]+"px","margin-right":b.spacing["margin-right"]+"px","padding-top":b.spacing["padding-top"]+"px","padding-bottom":b.spacing["padding-bottom"]+"px","padding-left":b.spacing["padding-left"]+"px","padding-right":b.spacing["padding-right"]+"px"});this.anchor.width(b.width);this.anchor.height(b.height);this.anchor.css("border-radius",b.sizeRef*this.options.borderRadius+"px");this.captMask.width(this.anchor.outerWidth(!1)-b.spacing["border-left"]-b.spacing["border-right"]);
this.captMask.height(this.anchor.outerHeight(!1)-b.spacing["border-top"]-b.spacing["border-bottom"]);this.options.capture?this.captMask.show():this.captMask.hide();this.options.onResize.call(this,b);var a=this.jBlocks.options.blockShadow;"undefined"!=typeof this.options.shadow&&(a=this.options.shadow);if(0!=a){var c=this.jBlocks.geometry.uWidth*a,e=this.jBlocks.geometry.uHeight*a,a=b.sizeRef*a;this.anchor.css({"-webkit-box-shadow":"-"+c+"px "+e+"px "+2.5*a+"px rgba(43, 45, 50, 0.55)","box-shadow":"-"+
c+"px "+e+"px "+2.5*a+"px rgba(43, 45, 50, 0.55)"})}this.display(b)},display:function(){},onLoggedIn:function(b){this.options.requireAuth&&!1==this.layout.visible&&(this.layout.visible=!0,this.jBlocks.checkLayout());this.options.requireAnon&&!0==this.layout.visible&&(this.layout.visible=!1,this.jBlocks.checkLayout());if(this.onLoggedInCallback)this.onLoggedInCallback(b)},onLoggedOut:function(){this.options.requireAuth&&!0==this.layout.visible&&(this.layout.visible=!1,this.jBlocks.checkLayout());this.options.requireAnon&&
!1==this.layout.visible&&(this.layout.visible=!0,this.jBlocks.checkLayout());if(this.onLoggedOutCallback)this.onLoggedOutCallback()},canFullscreen:function(){return null!=this.jBlocks.fullscreenMethods},fullscreen:function(b,a){if(1>arguments.length||!b)b=this.content;if(2>arguments.length||!a)udateFnt=function(){};this.jBlocks.fullscreen(b,a)},log:function(){$.jBlocks.apply(null,["log"].concat([].splice.call(arguments,0)))},t:function(){return $.jBlocks.apply(null,["translate"].concat([].splice.call(arguments,
0)))}});
$.jBlocks("defineBlockClass","Foo","Block",{init:function(){this._super.apply(this,arguments);this.letter=String.fromCharCode(65+this.constructor.fooIndex++)},onCreate:function(){this.content.css({"background-color":"rgba("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+",0.5)","text-align":"center"}).text(this.letter);this._super.call(this)},display:function(b){this.content.css({"line-height":b.height+"px","font-size":Math.min(b.height/2,0.8*b.width)+
"pt"})}}).fooIndex=0;
$.jBlocks("defineBlockClass","HtmlElement","Block",{element:null,init:function(){this._super.apply(this,arguments);this.options=$.extend({emargin:[0,0,0,0],epadding:[0,0,0,0],tag:"p"},this.options)},onCreate:function(){this.element=$("<"+this.options.tag+"/>").appendTo(this.content)},display:function(){var b=Math.min(this.jBlocks.geometry.uWidth,this.jBlocks.geometry.uHeight),a=b*this.options.emargin[0],c=b*this.options.emargin[1],e=b*this.options.emargin[2],l=b*this.options.emargin[3],n=b*this.options.epadding[0],
t=b*this.options.epadding[1],u=b*this.options.epadding[2],b=b*this.options.epadding[3],k=parseInt(this.element.css("border-top-width"))+parseInt(this.element.css("border-bottom-width")),r=parseInt(this.element.css("border-left-width"))+parseInt(this.element.css("border-right-width"));this.element.css({"margin-top":a+"px","margin-right":c+"px","margin-bottom":e+"px","margin-left":l+"px","padding-top":n+"px","padding-right":t+"px","padding-bottom":u+"px","padding-left":b+"px",height:this.content.height()-
n-a-u-e-k,width:this.content.width()-b-l-t-c-r})}});
$.jBlocks("defineBlockClass","Text","HtmlElement",{init:function(b,a){this._super.apply(this,arguments);this.options=$.extend({text:"",multiline:!1,containerTag:"p",emRatio:0.6,blockClass:"jblocks-simpletext"},this.options);this.options.tag=this.options.containerTag;this.options.epadding=[0,0.1,0,0.1]},onCreate:function(){this._super.apply(this);this.element.text(this.options.text)},display:function(b){this._super.apply(this,arguments);this.adjustSize(b)},adjustSize:function(b){this.options.multiline||
(this.element.addClass("jblocks-simpletext-single"),this.element.css({"line-height":b.height+"px"}))},textVal:function(){var b=this.element.text.apply(this.element,arguments);0<arguments.length&&(this.options.text=arguments[0],this.adjustSize({width:this.content.width(),height:this.content.height()}));return b}});
$.jBlocks("defineBlockClass","Image","Block",{init:function(b,a){this._super.apply(this,arguments);this.options=$.extend({onClick:null,stretch:"keep-ratio"},this.options);this.imageLoaded=!1;this.img=null;this.image=new Image},onCreate:function(){var b=this;this._super.apply(this,arguments);this.options.onClick&&(this.content.addClass("jblocks-clickable"),this.content.bind($.jBlocks("click"),function(){b.options.onClick.call(b)}));this.img=$("<img/>").appendTo(this.content);this.image.onload=function(){b.imageLoaded=
!0;b.img.attr("src",b.image.src);b.updateImage()};this.image.src=this.options.src},updateImage:function(){if(this.imageLoaded&&!(0>=this.content.width()||0>=this.content.height())){var b,a,c=0,e=0;"full-extend"==this.options.stretch?(b=this.content.width(),a=this.content.height()):"no-oversampling"==this.options.stretch&&this.image.width<this.content.width()&&this.image.height<this.content.height()?(b=this.image.width,a=this.image.height,c=(this.content.height()-this.image.height)/2,e=(this.content.width()-
this.image.width)/2):(a=this.image.width/this.image.height,b=this.content.width()/this.content.height(),a<b?(b=this.content.height()*a,a=this.content.height(),c=0,e=(this.content.width()-b)/2):(b=this.content.width(),a=this.content.width()/a,e=0,c=(this.content.height()-a)/2));this.img.css({width:b,height:a,"margin-left":e,"margin-top":c})}},display:function(){this.updateImage()}});
$.jBlocks("defineBlockClass","Input","HtmlElement",{init:function(){this._super.apply(this,arguments);this.options=$.extend({onCR:function(){},onKeyDown:function(){},text:""},this.options);this.options.tag="input";this.options.blockClass="jblocks-block-input"},onCreate:function(){this._super.apply(this);var b=this;this.element.val(this.options.text).bind("keydown",function(a){13==a.keyCode?b.options.onCR.call(b):b.options.onKeyDown.call(b,a.keyCode)})},display:function(){this._super.apply(this,arguments);
this.element.css({"font-size":0.6*this.element.height()+"pt"})},val:function(){return this.element.val.apply(this.element,arguments)}});
$.jBlocks("defineBlockClass","Checkbox","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({checked:!1,onChange:function(){},text:""},this.options);this.layout.expandHeight=0;this.options.blockContentClass="jblocks-clickable"},onCreate:function(){var b=this;this._super.apply(this);b=this;this.input=$("<div/>").addClass("jblocks-checkbox-ticker").css({"float":"left"}).appendTo(this.content);this.text=$("<p/>").text(this.options.text).css({"float":"left",margin:0}).appendTo(this.content);
this.content.bind($.jBlocks("click"),function(){b.options.checked=!b.options.checked;b.updateState();b.options.onChange.call(b,b.options.checked)});this.updateState()},updateState:function(){this.options.checked?this.input.addClass("jblocks-checkbox-checked"):this.input.removeClass("jblocks-checkbox-checked")},display:function(){this._super.apply(this,arguments);var b=this.content.height();this.input.css({height:b,width:b});this.text.css({"padding-left":b/4+"px","line-height":b+"px"})},val:function(){if(0<
arguments.length){var b=this.options.checked;this.options.checked=!arguments[0]?!1:!0;b!=this.options.checked&&(this.updateState(),this.options.onChange.call(this,this.options.checked))}return this.options.checked}});
$.jBlocks("defineBlockClass","Link","Text",{init:function(){this._super.apply(this,arguments);this.options=$.extend({onClick:function(){},attributes:{},iconUrl:null,iconPosition:"left",minTextW:1,noIconOverlay:!0,backgroundClass:"jblocks-block-green-link"},this.options)},onCreate:function(){var b=this;this._super();this.content.addClass("jblocks-block-link");this.content.addClass(this.options.backgroundClass);for(var a in this.options.attributes)this.text.attr(a,this.options.attributes[a]);this.content.bind($.jBlocks("click"),
function(){b.options.onClick.call(b)});this.options.iconUrl&&(this.iconImage=$("<div/>").css({"background-image":"url("+this.options.iconUrl+")","background-position":"center center","background-repeat":"no-repeat","background-size":"contain",position:"absolute",padding:0,margin:0,top:0}).appendTo(this.content),"left"==this.options.iconPosition?this.iconImage.css({left:0}):this.iconImage.css({right:0}),this.options.noIconOverlay&&("left"==this.options.iconPosition?this.options.epadding[3]=1:this.options.epadding[1]=
1),this.content.css("text-align",this.options.textAlign));this.element.hide()},display:function(){this.actualLayout.w<this.options.minTextW?this.textVal(""):this.textVal(this.options.text);this.element.show();this._super.apply(this,arguments);this.iconImage&&this.iconImage.css({width:this.content.width()/this.actualLayout.w*this.actualLayout.h,height:this.content.height()})}});
$.jBlocks("defineBlockClass","JBlock","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({jBlocksBlockClass:null,jBlocksBlockContentClass:null},this.options)},onCreate:function(){var b=this;this.selfJBlocks=this.content.jBlocks();this.selfJBlocks.updateOptions({onResize:function(a,c){var e=b.actualLayout.h||1;a.height/e<b.options.minPixels&&(e=Math.max(Math.floor(a.height/b.options.minPixels),1));0<b.options.minh&&e<b.options.minh&&(e=b.options.minh);0<b.options.maxh&&
e>b.options.maxh&&(e=b.options.maxh);var l=b.actualLayout.w||1;a.width/l<b.options.minPixels&&(l=Math.max(Math.floor(a.width/b.options.minPixels),1));0<b.options.minw&&l<b.options.minw&&(l=b.options.minw);0<b.options.maxw&&l>b.options.maxw&&(l=b.options.maxw);c.h=e;c.w=l},blockClass:this.options.jBlocksBlockClass,blockContentClass:this.options.jBlocksBlockContentClass});this.selfJBlocks.updateViewport({w:1,h:1,fixed:"both"});this.selfJBlocks.updateOptions({resizeDelay:5,layoutDelay:5,resizeAnimateDelay:100,
debugBlockLayout:this.jBlocks.options.debugBlockLayout})},onStartResize:function(b,a){this.onResize(a);this.content.trigger("jBlocks.resize",null)},onRemove:function(){this._super();this.selfJBlocks&&this.selfJBlocks.removeAllBlocks()},display:function(){},addNewBlock:function(){this.selfJBlocks.addNewBlock.apply(this.selfJBlocks,arguments);return this}});
$.jBlocks("defineBlockClass","Menu","JBlock",{init:function(b,a){this._super.apply(this,arguments);$.extend(this.options,{blockContentClass:"jblocks-block-menu"});this.options=$.extend({w:1,h:1,menuItems:[]},this.options)},onCreate:function(){var b=this;this._super();this.selfJBlocks.viewport.fixed="width";this.selfJBlocks.options.scrollable=!0;this.layout.h=this.jBlocks.viewport.h-1;this.layout.w=this.jBlocks.viewport.w;this.menuItems=[];for(var a in this.options.menuItems){var c={label:"--",onClick:function(){},
shouldDisplay:function(){return!0}};$.extend(c,this.options.menuItems[a]);var e=this.selfJBlocks.addNewBlock("Link",{w:1,h:1,pref:"left top",expandHeight:0,expandWidth:0},{text:c.label,containerTag:"a"});this.menuItems.push({data:c,block:e});(function(a){e.anchor.bind(jBlocks("click"),function(){a.onClick.call(b)})})(c)}this.selfJBlocks.updateOptions({onResize:function(a,c){c.w=b.options.w}})},display:function(){this._super();var b=0,a;for(a in this.menuItems){var c=this.menuItems[a];c.data.shouldDisplay()?
(c.block.layout.visible=!0,b++):c.block.layout.visible=!1}b=Math.min(b,this.jBlocks.viewport.h-1);this.layout.h=b;this.layout.w=4;this.jBlocks.checkLayout();this.selfJBlocks.updateViewport({h:b})}});
$.jBlocks("defineBlockClass","Icon","Block",{init:function(){this._super.apply(this,arguments);$.extend(this.layout,{w:1,h:1,expandWidth:0,expandHeight:0});this.options=$.extend({iconClass:"jblocks-block-icon",onClick:function(){}},this.options)},onCreate:function(){var b=this;this.content.addClass(this.options.iconClass);this.content.bind($.jBlocks("click"),function(){b.options.onClick.call(b)})}});
$.jBlocks("defineBlockClass","MenuIcon","Icon",{init:function(){var b=this;this._super.apply(this,arguments);$.extend(this.options,{blockContentClass:"jblocks-icon-menu",onClick:function(){b.menuClick()}});this.options=$.extend({menuItems:[]},this.options);this.menu=null},menuClick:function(){null==this.menu?this.menu=this.jBlocks.addNewBlock("Menu",{priority:1001,w:1,h:1,pref:"left top",expandWidth:0,expandHeight:0},{menuItems:this.options.menuItems}):(this.menu.layout.visible=this.menu.layout.visible?
!1:!0,this.jBlocks.checkLayout())}});
$.jBlocks("defineBlockClass","IFrame","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({src:"about:blank",data:null,syncViewportSize:!1},this.options)},onCreate:function(){var b=this;this.frame=$("<iframe/>").attr("frameborder","0").attr("scrolling","no").attr("marginwidth","0").attr("marginheight","0").attr("allowTransparency",!0).attr("webkitallowfullscreen",!0).attr("mozallowfullscreen",!0).attr("allowfullscreen",!0).css({"background-color":"transparent"});this.options.syncViewportSize&&
(this.options.data||(this.options.data={}),$.extend(this.options.data,{onResize:function(a,c){!b.jBlocks.canFullscreen()||!document[b.jBlocks.fullscreenMethods.element]?(c.w=b.actualLayout.w,c.h=b.actualLayout.h):this.options.defaultOnResize.call(this,a,c)}}));if(this.options.data){"undefined"==typeof $.jBlocks.frameData&&($.jBlocks.frameData={index:0,data:this.options.data});var a=$.jBlocks.frameData,c=a.index++;a.data[c]=this.options.data;this.frame.attr("name","jblocks-data-"+c)}this.frame.appendTo(this.content)},
display:function(b){this.frame.attr("width",b.width).attr("height",b.height);0<b.width&&(0<b.height&&void 0===this.frame.attr("src"))&&this.frame.attr("src",this.options.src)}});
$.jBlocks("defineBlockClass","Box","JBlock",{init:function(){this._super.apply(this,arguments);this.options=$.extend({title:"",focusOnTitleClick:!0,haveClose:!1,haveSearch:!1,haveMaximize:!0,haveFullscreen:!1,haveLogo:!1,logoIconClass:"jblocks-block-icon-logo",closeIconClass:"jblocks-icon-close",shrinkIconClass:"jblocks-icon-shrink",growIconClass:"jblocks-icon-grow",searchIconClass:"jblocks-icon-search",iconsBaseClass:"jblocks-block-icon",menuItems:[],onSearchClick:function(){}},this.options)},onCreate:function(){var b=
this;this._super();var a=this.selfJBlocks.options.onResize;this.selfJBlocks.options.onResize=function(){a.apply(this,arguments);b.options.layouts&&(b.growIcon.layout.visible=b.canGrow()?!0:!1,b.shrinkIcon.layout.visible=b.canShrink()?!0:!1)};var c=[];this.options.haveFullscreen&&c.push({label:this.t("fullscreen"),onClick:function(){this.layout.visible=!1;b.fullscreen(b.selfJBlocks.anchor,function(a){a?b.maximize():b.unMaximize();$(window).trigger("resize")})},shouldDisplay:function(){return b.canFullscreen()}});
for(var e in this.options.menuItems)c.push(this.options.menuItems[e]);this.options.haveLogo&&this.selfJBlocks.addNewBlock("Icon",{priority:1100,pref:"top left"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.logoIconClass});0<c.length&&this.selfJBlocks.addNewBlock("MenuIcon",{priority:1003,pref:"top left",h:1,w:1,expandHeight:0},{onClick:function(){alert("Open menu")},menuItems:c});this.options.haveClose&&this.selfJBlocks.addNewBlock("Icon",{priority:1002,pref:"top left"},{iconClass:this.options.iconsBaseClass,
blockContentClass:this.options.closeIconClass,onClick:function(){b.unMaximize();b.jBlocks.removeBlock(b.id)},tooltip:this.t("close")});this.options.haveSearch&&this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.searchIconClass,onClick:function(){b.options.onSearchClick.apply(b)},tooltip:this.t("search")});this.options.layouts&&(this.growIcon=this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},
{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.growIconClass,onClick:function(){b.grow()},tooltip:this.t("grow")}),this.shrinkIcon=this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.shrinkIconClass,onClick:function(){b.shrink()},tooltip:this.t("shrink")}));this.boxTitle=this.selfJBlocks.addNewBlock("Text",{h:1,w:2,priority:1E3,expandWidth:10,expandHeight:0},{containerTag:"h1",text:this.options.title});
this.options.focusOnTitleClick?(this.boxTitle.content.bind($.jBlocks("click"),function(){b.focus();b.jBlocks.checkLayout()}),this.boxTitle.content.css({cursor:"pointer"})):this.boxTitle.content.css({cursor:"default"})},setContent:function(b,a){2>arguments.length&&(a={});for(var c in this.selfJBlocks.blocks){var e=this.selfJBlocks.blocks[c];e._isBoxContent&&this.selfJBlocks.removeBlock(e.id)}c=this.selfJBlocks.addNewBlock(b,{w:1,h:2,pref:"right bottom",priority:999,expandWidth:2,expandHeight:2},$.extend(a,
{boxBlock:this}));c._isBoxContent=!0;return c},setTitle:function(b){this.boxTitle.textVal(b)}});
$.jBlocks("defineBlockClass","ScrollableHtml","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({htmlContent:"",scrollAnimation:0,verticalAlign:!1},this.options)},onCreate:function(){var b=this;this.scrollView=$("<div/>").css({}).appendTo(this.content).html(this.options.htmlContent);this.content.css({"-webkit-overflow-scrolling":"touch","overflow-y":"auto","overflow-x":"hidden"});this.content.bind("mousewheel DOMMouseScroll",function(a){b.content.height()<b.scrollView.height()&&
a.stopPropagation()})},checkState:function(){this.display()},display:function(){this.scrollView.css("padding-top",0);this.options.verticalAlign&&this.scrollView.height()<this.content.height()&&this.scrollView.css("padding-top",(this.content.height()-this.scrollView.height())/2)},getHtmlContainer:function(){return this.scrollView},scrollBottom:function(){this.content.scrollTop(this.scrollView.height()-this.content.height())},scrollTop:function(){this.content.scrollTop(0)},makeVisible:function(b,a){(this.content.scrollTop()>
b||this.content.scrollTop()+this.content.height()>b+a)&&this.content.scrollTop(Math.max(0,Math.min(b,this.scrollView.height()-a)))}});
$.jBlocks("defineBlockClass","List","JBlock",{init:function(){this._super.apply(this,arguments);this.options=$.extend({items:[],createItem:function(){return null},searchItem:null,haveSearch:!1,showSearch:!1,itemHeightRatio:0.66},this.options);this.options.scrollAnimation=400;this.items={};this.lastSearch=this.search=null},onCreate:function(){var b=this;this._super();this.options.haveSearch&&(this.search=this.selfJBlocks.addNewBlock("Input",{h:1,w:1,pref:"top left",priority:100,expandHeight:0,expandWidth:2,
visible:this.options.showSearch},{emargin:[0.1,0,0.1,0],epadding:[0.1,0,0.1,0],blockContentClass:"jblocks-list-search"}),$.jBlocks("log","search onCreate"),this.search.element.bind("input",function(a){var c=b.search.element.val();c!=b.lastSearch&&(b.lastSearch=c,b.filter());a.stopPropagation();b.refresh()}));this.content.addClass("jblocks-block-list");this.ul=$("<ul/>");this.list=this.selfJBlocks.addNewBlock("ScrollableHtml",{h:1,w:1,pref:"left top"},{onCreate:function(){this.getHtmlContainer().append(b.ul)},
contentBorderRadius:0,margin:[0,0,0,0],scrollAnimation:400,verticalAlign:!1});for(var a in this.options.items){var c=$("<li/>"),e=this.options.createItem.call(this,this.options.items[a],c);e&&(c.appendTo(this.ul),this.items[e]={li:c,data:this.options.items[a]})}},filter:function(b){var a=this.items;0<arguments.length&&(a={},a[b]=this.items[b]);for(var c in a){var e=a[c];if(this.lastSearch){var l=!1;null==this.options.searchItem?0<=e.li.html().replace(/<.*?>/g," ").toLowerCase().indexOf(this.lastSearch.toLowerCase())&&
(l=!0):this.options.searchItem(e.data,this.lastSearch)&&(l=!0);l?e.li.show():e.li.hide()}else e.li.show()}},updateLi:function(b){var a=Math.min(this.jBlocks.geometry.uHeight,this.jBlocks.geometry.uWidth)*this.options.itemHeightRatio,c=0.8*a,e=0.1*a;b.css({height:a,"line-height":a+"px"}).find("img").css({height:c,width:"auto",margin:e})},display:function(){this.updateLi(this.ul.children("li"));this.refresh()},sort:function(){if("function"==typeof this.options.sortFn){var b=[],a;for(a in this.items)b.push(a);
var c=this;b.sort(function(a,b){return c.options.sortFn(c.items[a].data,c.items[b].data)});for(var e in b)this.items[b[e]].li.detach().appendTo(this.ul)}},addItem:function(b){var a=$("<li/>"),c=this.options.createItem(b,a);c&&(a.appendTo(this.ul),this.items[c]={li:a,data:b},this.anchor&&this.updateLi(a));this.options.onItemAdded&&this.options.onItemAdded.call(this,b)},removeItem:function(b){if("undefined"!=typeof this.items[b]){var a=this.items[b];a.li.remove();delete this.items[b];this.options.onItemRemoved&&
this.options.onItemRemoved.call(this,a)}},clearAll:function(){this.ul.empty();this.items={}},refresh:function(){this.sort();this.list.checkState();this.options.onRefresh&&this.options.onRefresh.call(this)},toggleSearch:function(){this.search.layout.visible=!this.search.layout.visible;this.selfJBlocks.checkLayout()},scrollBottom:function(){this.list.scrollBottom()},scrollTop:function(){this.list.scrollTop()},shuffle:function(){var b=[],a;for(a in this.items)b.push(this.items[a].li.detach());a=b.length;
if(!(0>=a)){for(;--a;){var c;c=Math.floor(Math.random()*(a+1));var e=b[a];b[a]=b[c];b[c]=e}for(a in b)this.ul.append(b[a])}},ensureVisible:function(b){if(b=this.items[b]){var a=b.li.position();this.list.makeVisible(a.top,b.li.height())}}});
$.jBlocks("defineBlockClass","Select","List",{init:function(){var b=this;this._super.apply(this,arguments);this.options=$.extend({opened:!1,selected:null,selWidgetClass:"jblocks-block-grey",onChange:function(){}},this.options);this.superCreateItem=this.options.createItem;this.options.createItem=function(a,c){var e=b.superCreateItem.call(this,a,c);c.bind($.jBlocks("click"),function(){b.val(e);b.list.layout.visible=!1;b.selWidget.layout.visible=!0;b.selfJBlocks.checkLayout();b.options.opened=!1;b.jBlocks.checkLayout()});
return e};this.superH=this.options.h;this.superLayoutH=this.layout.h;this.options.h=function(a){return b.options.opened?b.superH?b.superH.call(b,a):this.superLayoutH:1}},updateSelected:function(){var b="";this.ul.find("li").removeClass("jblocks-selected");null!=this.options.selected&&this.items[this.options.selected]&&(b=this.items[this.options.selected].li.text(),this.items[this.options.selected].li.addClass("jblocks-selected"));this.selWidget.textVal(b)},addItem:function(b){this._super(b);b.value==
this.options.selected&&this.updateSelected()},onCreate:function(){var b=this;this._super.apply(this,arguments);this.selWidget=this.selfJBlocks.addNewBlock("Link",{h:1,w:b.layout.w,expandHeight:0},{text:"",epadding:[0,1,0,0],onClick:function(){b.list.layout.visible=!0;b.selWidget.layout.visible=!1;b.selfJBlocks.checkLayout();b.options.opened=!0;b.jBlocks.checkLayout()}});this.selWidget.content.addClass("jblocks-select");this.selWidget.anchor.addClass(this.options.selWidgetClass);this.options.opened?
(this.list.layout.visible=!0,this.selWidget.layout.visible=!1):(this.list.layout.visible=!1,this.selWidget.layout.visible=!0);this.updateSelected()},val:function(){if(0<arguments.length){var b=arguments[0];b!=this.options.selected&&(this.options.selected=b,this.updateSelected(),this.options.onChange.call(this,b))}return this.options.selected}});
$.jBlocks("defineBlockClass","YouTubeVideo","IFrame",{init:function(){this._super.apply(this,arguments);$.extend(this.options,{src:"http://www.youtube.com/embed/"+this.options.youtubeID});this.options=$.extend({blockContentClass:"jblocks-block-video"},this.options)}});$.jBlocks("defineBlockClass","Spacer","Block",{init:function(){this._super.apply(this,arguments)}});
$.jBlocks("defineBlockClass","Log","ScrollableHtml",{init:function(){this._super.apply(this,arguments);this.options.padding=[0.15,0.15,0.15,0.15];this.nbEntries=0;this.options=$.extend({refreshPeriod:500,maxEntries:100},this.options)},onCreate:function(){var b=this;this._super.call(this);this.getHtmlContainer().addClass("jblocks-log").css({"background-color":"White",border:"2px inset #808080",padding:5});this.updateTimer=setInterval(function(){b.updateLog()},this.options.refreshPeriod)},onRemove:function(){this.updateTimer&&
clearInterval(this.updateTimer)},updateLog:function(){var b=this.getHtmlContainer().children().length;b!=this.nbEntries&&(b-=this.options.maxEntries,0<b&&this.getHtmlContainer().children().slice(0,b).remove(),this.checkState(),this.scrollBottom(),this.nbEntries=this.getHtmlContainer().children().length)},display:function(){this._super();this.scrollBottom()},clearLog:function(){this.getHtmlContainer().empty();this.checkState()}});
$.jBlocks("defineBlockClass","LogBox","Box",{init:function(){var b=this;this._super.apply(this,arguments);this.options.title=this.t("Log");this.options.jBlocksBlockClass="jblocks-block-brown";this.options.haveClose=!0;this.options.menuItems.push({label:"Clear",onClick:function(){this.layout.visible=!1;b.clearLog()}})},onCreate:function(){this._super();this.logPanel=this.setContent("Log")},clearLog:function(){this.logPanel.clearLog()}});
$.jBlocks("defineBlockClass","TextBox","Box",{init:function(){this._super.apply(this,arguments);this.options=$.extend({text:"",multiline:!1,containerTag:"p"},this.options)},onCreate:function(){this._super();this.textPanel=this.setContent("Text",{text:this.options.text,containerTag:this.options.containerTag,multiline:this.options.multiline})}});
$.jBlocks("defineBlockClass","ScrollableHtmlBox","Box",{init:function(){this._super.apply(this,arguments);this.options=$.extend({htmlContent:""},this.options)},onCreate:function(){this._super();this.textPanel=this.setContent("ScrollableHtml",{htmlContent:this.options.htmlContent})}});$.jBlocks("defineBlockClass","Persona","IFrame",{init:function(){this._super.apply(this,arguments);$.extend(this.options,{src:"/jblocks/login/persona",onLogin:function(){},onLogout:function(){}})},onCreate:function(){this._super()}});
$.jBlocks("defineBlockClass","PersonaBox","JBlock",{init:function(){this._super.apply(this,arguments);$.extend(this.layout,{expandHeight:0,expandWidth:0.1});this.highlight()},onCreate:function(){this._super();var b=this;this.userBox=this.selfJBlocks.addNewBlock("Text",{w:1,h:1,expandHeight:0,visible:!1},{verticalAlign:!0,blockContentClass:"jblocks-logged-as"});this.selfJBlocks.addNewBlock("Persona",{w:1,h:2,pref:"left bottom"},{});$(document).bind("jblocks.logincreate",function(){b.options.w=function(a){return a.w};
b.options.h=function(a){return a.h};b.focus();b.jBlocks.checkLayout()});$(document).bind("jblocks.logincancel",function(){delete b.options.w;delete b.options.h;b.jBlocks.checkLayout()});$(document).bind("jblocks.login",function(a,c){b.unhighlight();b.userBox.textVal(b.t("logged-as",{"@name":c.name}));b.userBox.layout.visible=!0;b.options.onLogin.call(b,c);b.selfJBlocks.checkLayout();b.jBlocks.checkLayout()});$(document).bind("jblocks.logout",function(){b.highlight();b.userBox.layout.visible=!1;b.options.onLogout.call(b);
b.selfJBlocks.checkLayout();b.jBlocks.checkLayout()})},highlight:function(){$.extend(this.layout,{priority:1200,w:6,h:2,pref:"top right"})},unhighlight:function(){$.extend(this.layout,{priority:0,w:6,h:3,pref:"bottom right"})}});
