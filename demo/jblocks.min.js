(function(b){function a(a,d){var j,n,t;function s(a){b("body").addClass("noSelect");var c=parseInt(k.obj.css(p),10);j=m?a.pageX:a.pageY;n="auto"==c?0:c;J?(document.ontouchmove=function(b){b.preventDefault();q(b.touches[0])},document.ontouchend=v):(b(document).bind("mousemove",q),b(document).bind("mouseup",v),k.obj.bind("mouseup",v))}function l(a){if(1>f.ratio&&(a=a||window.event,x-=(a.wheelDelta?a.wheelDelta/120:-a.detail/3)*d.wheel,x=Math.min(f[d.axis]-r[d.axis],Math.max(0,x)),k.obj.css(p,x/g.ratio),
f.obj.css(p,-x),d.lockscroll||x!==f[d.axis]-r[d.axis]&&0!==x))a=b.event.fix(a),a.preventDefault()}function q(b){1>f.ratio&&(t=d.invertscroll&&J?Math.min(e[d.axis]-k[d.axis],Math.max(0,n+(j-(m?b.pageX:b.pageY)))):Math.min(e[d.axis]-k[d.axis],Math.max(0,n+((m?b.pageX:b.pageY)-j))),x=t*g.ratio,f.obj.css(p,-x),k.obj.css(p,t))}function v(){b("body").removeClass("noSelect");b(document).unbind("mousemove",q);b(document).unbind("mouseup",v);k.obj.unbind("mouseup",v);document.ontouchmove=document.ontouchend=
null}var r={obj:b(".viewport",a)},f={obj:b(".overview",a)},g={obj:b(".scrollbar",a)},e={obj:b(".track",g.obj)},k={obj:b(".thumb",g.obj)},m="x"===d.axis,p=m?"left":"top",h=m?"Width":"Height",x=0;t=n=0;j=void 0;var J="ontouchstart"in document.documentElement;this.update=function(b){r[d.axis]=r.obj[0]["offset"+h];f[d.axis]=f.obj[0]["scroll"+h];f.ratio=r[d.axis]/f[d.axis];g.obj.toggleClass("disable",1<=f.ratio);e[d.axis]="auto"===d.size?r[d.axis]:d.size;k[d.axis]=Math.min(e[d.axis],Math.max(0,"auto"===
d.sizethumb?e[d.axis]*f.ratio:d.sizethumb));g.ratio="auto"===d.sizethumb?f[d.axis]/e[d.axis]:(f[d.axis]-r[d.axis])/(e[d.axis]-k[d.axis]);x="relative"===b&&1>=f.ratio?Math.min(f[d.axis]-r[d.axis],Math.max(0,x)):0;x="bottom"===b&&1>=f.ratio?f[d.axis]-r[d.axis]:isNaN(parseInt(b,10))?x:parseInt(b,10);b=h.toLowerCase();k.obj.css(p,x/g.ratio);var a={};a[p]=-x;d.animation?f.obj.animate(a,d.animation):f.obj.css(p,-x);j=k.obj.offset()[p];g.obj.css(b,e[d.axis]);e.obj.css(b,e[d.axis]);k.obj.css(b,k[d.axis])};
this.update();J?r.obj[0].ontouchstart=function(b){1===b.touches.length&&(s(b.touches[0]),b.stopPropagation())}:(k.obj.bind("mousedown",s),e.obj.bind("mouseup",q));d.scroll&&window.addEventListener?(a[0].addEventListener("DOMMouseScroll",l,!1),a[0].addEventListener("mousewheel",l,!1)):d.scroll&&(a[0].onmousewheel=l);return this}b.tiny=b.tiny||{};b.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:50,invertscroll:!0,animation:0}};b.fn.tinyscrollbar=function(c){var d=
b.extend({},b.tiny.scrollbar.options,c);this.each(function(){b(this).data("tsb",new a(b(this),d))});return this};b.fn.tinyscrollbar_update=function(a){try{return b(this).data("tsb").update(a)}catch(d){return b(this)}}})(jQuery);
(function(b){function a(a){if(a&&void 0===a.allowPageScroll&&(void 0!==a.swipe||void 0!==a.swipeStatus))a.allowPageScroll=q;a||(a={});a=b.extend({},b.fn.swipe.defaults,a);return this.each(function(){var d=b(this),e=d.data(x);e||(e=new c(this,a),d.data(x,e))})}function c(a,c){function L(a){if(!0!==y.data(x+"_intouch")&&!(0<b(a.target).closest(c.excludedElements,y).length)){a=a.originalEvent;var u,d=h?a.touches[0]:a;z=e;h?B=a.touches.length:a.preventDefault();E=0;M=G=null;H=P=C=0;N=1;for(var f=[],j=
0;5>=j;j++)f.push({start:{x:0,y:0},end:{x:0,y:0},delta:{x:0,y:0}});w=f;if(!h||B===c.fingers||c.fingers===g||R()){if(w[0].start.x=w[0].end.x=d.pageX,w[0].start.y=w[0].end.y=d.pageY,V=(new Date).getTime(),2==B&&(w[1].start.x=w[1].end.x=a.touches[1].pageX,w[1].start.y=w[1].end.y=a.touches[1].pageY,P=H=O(w[0].start,w[1].start)),c.swipeStatus||c.pinchStatus)u=A(a,z)}else I(a),u=!1;if(!1===u)return z=p,A(a,z),u;F(!0);y.bind(Y,D);y.bind(Z,K)}}function D(b){b=b.originalEvent;if(!(z===m||z===p)){var a,u=h?
b.touches[0]:b;w[0].end.x=h?b.touches[0].pageX:u.pageX;w[0].end.y=h?b.touches[0].pageY:u.pageY;S=(new Date).getTime();G=T(w[0].start,w[0].end);h&&(B=b.touches.length);z=k;2==B&&(0==P?(w[1].start.x=b.touches[1].pageX,w[1].start.y=b.touches[1].pageY,P=H=O(w[0].start,w[1].start)):(w[1].end.x=b.touches[1].pageX,w[1].end.y=b.touches[1].pageY,H=O(w[0].end,w[1].end),M=1>N?l:s),N=(1*(H/P)).toFixed(2));if(B===c.fingers||c.fingers===g||!h){var u=b,e=G;if(c.allowPageScroll===q||R())u.preventDefault();else{var F=
c.allowPageScroll===v;switch(e){case d:(c.swipeLeft&&F||!F&&c.allowPageScroll!=r)&&u.preventDefault();break;case j:(c.swipeRight&&F||!F&&c.allowPageScroll!=r)&&u.preventDefault();break;case n:(c.swipeUp&&F||!F&&c.allowPageScroll!=f)&&u.preventDefault();break;case t:(c.swipeDown&&F||!F&&c.allowPageScroll!=f)&&u.preventDefault()}}E=Q(w[0].start,w[0].end);C=S-V;if(c.swipeStatus||c.pinchStatus)a=A(b,z);c.triggerOnTouchEnd||(u=!(c.maxTimeThreshold?!(C>=c.maxTimeThreshold):1),!0===(null!==c.threshold?E>=
c.threshold:null)?(z=m,a=A(b,z)):u&&(z=p,A(b,z)))}else z=p,A(b,z);!1===a&&(z=p,A(b,z))}}function K(b){b=b.originalEvent;if(b.touches&&0<b.touches.length)return!0;b.preventDefault();S=(new Date).getTime();0!=P&&(H=O(w[0].end,w[1].end),N=(1*(H/P)).toFixed(2),M=1>N?l:s);E=Q(w[0].start,w[0].end);G=T(w[0].start,w[0].end);C=S-V;if(c.triggerOnTouchEnd||!1===c.triggerOnTouchEnd&&z===k){z=m;var a=M&&R()||!R(),u=0!==w[0].end.x;if((B===c.fingers||c.fingers===g||!h)&&u&&a)if(a=c.maxTimeThreshold?C>=c.maxTimeThreshold?
!1:!0:!0,u=null!==c.threshold?E>=c.threshold:null,(!0===u||null===u)&&a)A(b,z);else{if(!a||!1===u)z=p,A(b,z)}else z=p,A(b,z)}else z===k&&(z=p,A(b,z));y.unbind(Y,D,!1);y.unbind(Z,K,!1);F(!1)}function I(){H=P=V=S=B=0;N=1;F(!1)}function A(b,a){var u=void 0;c.swipeStatus&&(u=c.swipeStatus.call(y,b,a,G||null,E||0,C||0,B));c.pinchStatus&&(M&&R())&&(u=c.pinchStatus.call(y,b,a,M||null,H||0,C||0,B,N));if(a===p&&c.click&&(1===B||!h)&&(isNaN(E)||0===E))u=c.click.call(y,b,b.target);if(a==m){c.swipe&&(u=c.swipe.call(y,
b,G,E,C,B));switch(G){case d:c.swipeLeft&&(u=c.swipeLeft.call(y,b,G,E,C,B));break;case j:c.swipeRight&&(u=c.swipeRight.call(y,b,G,E,C,B));break;case n:c.swipeUp&&(u=c.swipeUp.call(y,b,G,E,C,B));break;case t:c.swipeDown&&(u=c.swipeDown.call(y,b,G,E,C,B))}switch(M){case s:c.pinchIn&&(u=c.pinchIn.call(y,b,M||null,H||0,C||0,B,N));break;case l:c.pinchOut&&(u=c.pinchOut.call(y,b,M||null,H||0,C||0,B,N))}}(a===p||a===m)&&I(b);return u}function O(b,a){var c=Math.abs(b.x-a.x),u=Math.abs(b.y-a.y);return Math.round(Math.sqrt(c*
c+u*u))}function Q(b,a){return Math.round(Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)))}function T(b,a){var c;c=Math.atan2(a.y-b.y,b.x-a.x);c=Math.round(180*c/Math.PI);0>c&&(c=360-Math.abs(c));return 45>=c&&0<=c?d:360>=c&&315<=c?d:135<=c&&225>=c?j:45<c&&135>c?t:n}function u(){y.unbind(W,L);y.unbind(X,I);y.unbind(Y,D);y.unbind(Z,K);F(!1)}function R(){return c.pinchStatus||c.pinchIn||c.pinchOut}function F(b){y.data(x+"_intouch",!0===b?!0:!1)}var aa=h||!c.fallbackToMouseEvents,W=aa?"touchstart":
"mousedown",Y=aa?"touchmove":"mousemove",Z=aa?"touchend":"mouseup",X="touchcancel",E=0,G=null,C=0,P=0,H=0,N=1,M=0,y=b(a),z="start",B=0,w=null,V=0,S=0;try{y.bind(W,L),y.bind(X,I)}catch(ba){b.error("events not supported "+W+","+X+" on jQuery.swipe")}this.enable=function(){y.bind(W,L);y.bind(X,I);return y};this.disable=function(){u();return y};this.destroy=function(){u();y.data(x,null);return y}}var d="left",j="right",n="up",t="down",s="in",l="out",q="none",v="auto",r="horizontal",f="vertical",g="all",
e="start",k="move",m="end",p="cancel",h="ontouchstart"in window,x="TouchSwipe";b.fn.swipe=function(c){var d=b(this),e=d.data(x);if(e&&"string"===typeof c){if(e[c])return e[c].apply(this,Array.prototype.slice.call(arguments,1));b.error("Method "+c+" does not exist on jQuery.swipe")}else if(!e&&("object"===typeof c||!c))return a.apply(this,arguments);return d};b.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,
pinchIn:null,pinchOut:null,pinchStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"button, input, select, textarea, a, .noSwipe"};b.fn.swipe.phases={PHASE_START:e,PHASE_MOVE:k,PHASE_END:m,PHASE_CANCEL:p};b.fn.swipe.directions={LEFT:d,RIGHT:j,UP:n,DOWN:t,IN:s,OUT:l};b.fn.swipe.pageScroll={NONE:q,HORIZONTAL:r,VERTICAL:f,AUTO:v};b.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:g}})(jQuery);
(function(b){function a(a){null==a&&(a=/^(.*?)[^\/]*$/.exec(x)[1]+"jblocks.worker.js");a=new Worker(a);a.addEventListener("message",function(a){a=a.data;"log"==a.cmd?b.jBlocks("log","[Worker]",a.args.str):b(document).trigger("jblocks.worker",a)});return a}function c(a){this.anchor=0<arguments.length?arguments[0]:null;this.blocks={};this.layoutsStack=[];this.layoutCache={};this.layoutCount=0;this.worker=this.geometrySizeSign=this.layoutSign=this.layouts=null;this.scrollable=!1;this.jBlocksLayoutTimer=
this.jBlocksResizeTimer=null;this.layoutInProgress=0;this.focusedBlockId=this.loggedIn=null;this.layoutData={rmk:{rows:{},cols:{}},maxSize:{w:1,h:1},misfits:{}};this.jBlocksIndex=k++;this.viewport={r:0,c:0,w:0,h:0,minw:3,minh:3,zoomSeed:1E3,fillHoles:!0,fixed:"width"};this.options={resizeDelay:50,layoutDelay:50,resizeAnimateDelay:400,scrollAnimateDelay:400,resizeCallback:function(){},scrollable:!1,debug:!1,debugBlockLayout:!1,blockClass:null,blockContentClass:null,defaultOnResize:function(b,a){this.updateViewportFromGeometry(b,
a,{pixels:75,minw:12,maxw:30,minh:12,maxh:24})},onResize:function(a,c){var u=b.jBlocks("getFrameData");u&&"function"==typeof u.onResize?u.onResize.call(this,a,c):this.options.defaultOnResize.call(this,a,c)},onLayoutDone:function(){},fontSizeRatio:0.25,lineHeightRatio:1,updateFontSize:!0,margin:[0.05,0.05,0.05,0.05],padding:[0.05,0.05,0.05,0.05],blockShadow:0,ownWorker:!1,workerURL:null,preInit:function(){},postInit:function(){}};this.geometry={top:0,left:0,width:1,height:1,uWidth:1,uHeight:1};D?this.init():
U.push(this)}function d(a,c,d){3>arguments.length&&(d=/^(.*?)[^\/]*$/.exec(x)[1]+"res/sounds/");"/"!=d[d.length-1]&&(d+="/");K||(K=b("<div/>").hide().appendTo(b("body")));var e=K.find("[jblocks-sound="+a+"]");c?(0==e.length&&(e=b("<audio/>").attr("jblocks-sound",a).appendTo(K)),e.empty(),b("<source/>").attr("src",d+c+".ogg").attr("type","audio/ogg").appendTo("audio"),b("<source/>").attr("src",d+c+".mp3").attr("type","audio/mp3").appendTo("audio")):e.remove()}function j(b){if(K){var a=K.find("[jblocks-sound="+
b+"]");if(0<a.length){var a=a[0],c=null;"undefined"!=typeof device&&/iphone|ipad|ipod|ios/i.test(device.platform)&&(c="ios");"undefined"==typeof I&&(I=!1,"undefined"!=typeof device&&("Android"==device.platform&&"2"==device.version.charAt(0))&&(I=!0),"undefined"!=typeof device&&/iphone|ipad|ipod|ios/i.test(device.platform)&&(I=!0));if(I){"undefined"==typeof A&&(A={});if("undefined"==typeof A[b]){for(a=a.firstChild;a&&!(/source/i.test(a.nodeName)&&"audio/mp3"==a.getAttribute("type"));)a=a.nextSibling;
a?(a=a.getAttribute("src"),/^file:\/\//.test(a)&&(a=/^file:\/\/(.*)$/.exec(a)[1]),"ios"==c&&(a=a.replace(/^(\.\.\/)*/,"")),A[b]=new Media(a,function(){},function(){},function(){})):A[b]=null}A[b]&&A[b].play()}else a.cloneNode(!0).play()}}}function n(){Q||(Q=new c(null));Q.options.ownWorker=!0;return Q}function t(){for(var a=[],c=0;c<arguments.length;c++){var d=arguments[c];if("string"!=typeof d)try{d=JSON.stringify(d)}catch(e){d="<???>"}a.push(""+d)}a=a.join(" ");D?b(".jblocks-log").append(b("<p/>").text(a)):
m.push(a)}function s(b){for(var a in b)T[a]=b[a]}function l(b,a){2>arguments.length&&(a={});var c=T[b];if("undefined"==typeof c)c=b;else for(var d in a)c=c.replace(RegExp(d,"g"),a[d]);return c}function q(){if(!window.name)return null;var b=/^jblocks-data-([0-9]+)$/.exec(window.name);if(!b)return null;b=b[1];return!window.parent||!window.parent.$||!window.parent.$.jBlocks||!window.parent.$.jBlocks.frameData||!window.parent.$.jBlocks.frameData.data[b]?null:window.parent.$.jBlocks.frameData.data[b]}
function v(){try{var b=e[arguments[2]].extend(arguments[3]);return e[arguments[1]]=b}catch(a){alert("!!! "+a+"\n"+JSON.stringify(arguments))}}var r=function(){},f=!1,g=/xyz/.test(function(){})?/\b_super\b/:/.*/;r.extend=function(b){function a(b){!f&&this.init&&(0<arguments.length&&b.jBlocksArgsList?this.init.apply(this,b):this.init.apply(this,arguments))}var c=this.prototype;f=!0;var d=new this;f=!1;for(var e in b)d[e]="function"==typeof b[e]&&"function"==typeof c[e]&&g.test(b[e])?function(b,a){return function(){var u=
this._super;this._super=c[b];var d=a.apply(this,arguments);this._super=u;return d}}(e,b[e]):b[e];a.prototype=d;a.prototype.constructor=a;a.extend=arguments.callee;return a};var e={Class:r},k=0,m=[],p=0,h=(new Date).getTime(),x,r=document.getElementsByTagName("script");x=r[r.length-1].src;var J=null;c.prototype={};c.prototype.getWorker=function(){var c=this;if("undefined"==typeof Worker)return null;if(this.worker)return this.worker;this.options.ownWorker?this.worker=a(this.options.workerURL):(J||(J=
a(this.options.workerURL)),this.worker=J);b(document).bind("jblocks.worker",function(b,a){if(a.jBlocksIndex==c.jBlocksIndex)switch(a.cmd){case "layouts":c.layoutInProgress--;c.layoutCache[a.args.signature]={layouts:JSON.parse(JSON.stringify(a.args.layouts)),layoutData:JSON.parse(JSON.stringify(a.args.layoutData)),lastUsed:(new Date).getTime()};c.checkSanity(a.args.layouts,a.args.layoutData);c.layouts=a.args.layouts;c.layoutData=a.args.layoutData;for(var d in a.args.layouts){var e=a.args.layouts[d],
h=c.blocks[e.block.id];h&&!1==h.options.earlyLayout&&c.applyBlockLayout(e)}a.args.signature==c.layoutSign&&c.layoutDone();break;case "layout":d=a.args.layout.block.id,a.args.misfit?c.layoutData.misfits[d]=!0:delete c.layoutData.misfits[d],(h=c.blocks[d])&&h.options.earlyLayout&&c.applyBlockLayout(a.args.layout)}});return this.worker};c.prototype.init=function(){var a=this;null==this.anchor&&(this.anchor=b("body").first());this.options.preInit.call(this);this.anchor.data("jBlocks",this);this.anchor.empty();
this.fullscreenMethods=this.getFullscreenMethods();this.frame=b("<div/>").addClass("jblocks-frame").css({}).appendTo(this.anchor);this.frameContent=b("<div/>").addClass("jblocks-frame-content").css({}).appendTo(this.frame);for(var c in this.blocks)this.blocks[c].create(this.anchor);this.anchor.bind("jBlocks.resize",function(b,c){c||(c={width:a.anchor.width(),height:a.anchor.height()});a.jBlocksResizeTimer&&clearTimeout(a.jBlocksResizeTimer);a.jBlocksResizeTimer=setTimeout(function(){a.jBlocksResizeTimer=
null;var b=a.anchor.children(".jblocks-frame").children(".jblocks-frame-content");b.width(c.width);b.height(c.height);a.geometry.width=c.width;a.geometry.height=c.height;a.geometry.uWidth=a.geometry.width/a.viewport.w;a.geometry.uHeight=a.geometry.height/a.viewport.h;a.options.onResize.call(a,a.geometry,a.viewport);a.geometry.uWidth=a.geometry.width/a.viewport.w;a.geometry.uHeight=a.geometry.height/a.viewport.h;a.options.updateFontSize&&(b=Math.min(a.geometry.uHeight,a.geometry.uWidth),a.frameContent.css({"font-size":b*
a.options.fontSizeRatio+"pt"}));a.checkLayout()},a.options.resizeDelay);b.stopPropagation()});b(document).bind("jblocks.login",function(b,c){a.loggedIn=c;for(var d in a.blocks)a.blocks[d].onLoggedIn(c)});b(document).bind("jblocks.logout",function(){a.loggedIn=null;for(var b in a.blocks)a.blocks[b].onLoggedOut()});this.updateOptions({});this.checkLayout();this.options.postInit.call(this)};c.prototype.getSelf=function(){return this};c.prototype.newBlock=function(){if(!e[arguments[0]])throw"Unknown class "+
arguments[0];var b=e[arguments[0]],a=Array.prototype.slice.call(arguments,1);a.jBlocksArgsList=!0;b=new b(a);b.className=arguments[0];return b};c.prototype.addBlock=function(b){this.blocks[b.id]=b;b.jBlocks=this;D&&b.create(this.anchor);this.checkLayout()};c.prototype.addNewBlock=function(){var b=c.prototype.newBlock.apply(this,arguments);this.addBlock(b);return b};c.prototype.removeBlock=function(b){var a=this.blocks[b];a&&(a.onRemove(),delete this.blocks[b]);this.checkLayout()};c.prototype.blocksByTag=
function(b){var a=[],c;for(c in this.blocks){var d=this.blocks[c];d.tags[b]&&a.push(d)}return a};c.prototype.removeBlocksByTag=function(b){b=this.blocksByTag(b);for(var a in b)this.removeBlock(b[a].id)};c.prototype.removeAllBlocks=function(){for(var b in this.blocks)this.removeBlock(this.blocks[b].id)};c.prototype.updateViewport=function(a){b.extend(this.viewport,a);this.checkLayout()};c.prototype.updateOptions=function(a){b.extend(this.options,a);this.options.scrollable&&!this.scrollable&&this.makeScrollable();
!this.options.scrollable&&this.scrollable&&this.unmakeScrollable()};c.prototype.getLayoutSign=function(){var a={},c;for(c in this.blocks){var d=this.blocks[c];a[d.id]=d.layout}return b.jBlocks.util.md5(JSON.stringify({_1:a,_2:this.viewport}))};c.prototype.applyBlockLayout=function(a){var c=this.blocks[a.block.id];if("undefined"==typeof c)b.jBlocks("log","Unknown block id",a.block.id),this.anchor.find("#jblocks-block-"+this.jBlocksIndex+"-"+a.block.id).hide();else if(c.actualLayout=a,!1==c.layout.visible||
this.layoutData.misfits[c.id])c.anchor.hide();else{c.anchor.show();var d=c.anchor.position(),e=c.anchor.width(),h=c.anchor.height(),f=d.top,d=d.left,j={width:Math.round(a.w*this.geometry.uWidth),height:Math.round(a.h*this.geometry.uHeight),left:Math.round(a.c*this.geometry.uWidth),top:Math.round(a.r*this.geometry.uHeight)};e!=j.width||h!=j.height?(a=c.getContentGeometry(j,this.geometry.uWidth,this.geometry.uHeight),c.onStartResize(a,j),a.top=j.top,a.left=j.left,c.anchor.stop().animate(a,this.options.resizeAnimateDelay,
function(){c.content.show();c.onResize(j)})):(d!=j.left||f!=j.top)&&c.anchor.stop().animate({left:Math.round(a.c*this.geometry.uWidth),top:Math.round(a.r*this.geometry.uHeight)},this.options.resizeAnimateDelay,function(){})}};c.prototype.applyLayout=function(){for(var a in this.layoutData.misfits)if(this.layoutData.misfits[a]){var b=this.blocks[a];b&&b.anchor.hide()}for(var c in this.layouts)this.applyBlockLayout(this.layouts[c])};c.prototype.layoutDone=function(){var a=this.jBlocksIndex+": "+(this.layoutInProgress+
1)+" "+ ++this.layoutCount+" "+this.viewport.w+"x"+this.viewport.h+" ("+this.layoutData.maxSize.w+"x"+this.layoutData.maxSize.h+") "+((new Date).getTime()-this.layoutStatsT0)+"ms";this.options.debug&&(b("head title").text(a),t(a));"height"==this.viewport.fixed||"both"==this.viewport.fixed?this.viewport.r=0:this.viewport.h+this.viewport.r>this.layoutData.maxSize.h&&this.layoutData.maxSize.h-this.viewport.h&&(this.viewport.r=Math.max(0,this.layoutData.maxSize.h-this.viewport.h));"width"==this.viewport.fixed||
"both"==this.viewport.fixed?this.viewport.c=0:this.viewport.w+this.viewport.c>this.layoutData.maxSize.w&&this.layoutData.maxSize.w-this.viewport.w&&(this.viewport.c=Math.max(0,this.layoutData.maxSize.w-this.viewport.w));if(this.focusedBlockId&&(a=this.blocks[this.focusedBlockId])){var a=a.actualLayout,c=this.viewport.r,d=this.viewport.c;a.r+a.h>this.viewport.r+this.viewport.h?this.viewport.r=Math.max(a.r+a.h-this.viewport.h,0):a.r<this.viewport.r&&(this.viewport.r=a.r);a.c+a.w>this.viewport.c+this.viewport.w?
this.viewport.c=Math.max(a.c+a.w-this.viewport.w,0):a.c<this.viewport.c&&(this.viewport.c=a.c);if(this.viewport.r!=c||this.viewport.c!=d)a={top:-this.viewport.r*this.geometry.uHeight,left:-this.viewport.c*this.geometry.uWidth},this.frameContent.stop().animate(a,this.options.scrollAnimateDelay)}this.frameContent.stop().animate({top:-this.viewport.r*this.geometry.uHeight,left:-this.viewport.c*this.geometry.uWidth},this.options.scrollAnimateDelay);this.focusedBlockId=null;this.options.onLayoutDone.call(this)};
c.prototype.focusBlockId=function(a){this.focusedBlockId=a};c.prototype.checkSanity=function(a,b){var c=[],d={},e;for(e in a){var h=a[e];d[h.block.id]=!0;b.misfits[h.block.id]&&alert("in both layouts and misfit "+h.block.id);h.block.visible&&!b.misfits[h.block.id]&&c.push(h)}for(e in c){var h=c[e],j;for(j in c){var f=c[j];e!=j&&(f.r<h.r+h.h&&f.r+f.h>h.r&&f.c<h.c+h.w&&f.c+f.w>h.c)&&alert("mismatch "+h.block.id+" "+f.block.id+" "+JSON.stringify(h)+" "+JSON.stringify(f))}}for(var g in this.blocks)c=
this.blocks[g],!d[c.id]&&!b.misfits[c.id]&&t("missing block "+c.id)};c.prototype.rebuild=function(){if(!(0==this.viewport.h||0==this.viewport.w)){this.layoutStatsT0=(new Date).getTime();if(0==this.layoutInProgress){var a=this.layoutCache[this.layoutSign];if(a){this.checkSanity(a.layouts,a.layoutData);a.lastUsed=(new Date).getTime();this.layoutData=JSON.parse(JSON.stringify(a.layoutData));this.layouts=JSON.parse(JSON.stringify(a.layouts));this.applyLayout();this.layoutDone();return}}var a=[],c;for(c in this.blocks){var d=
{id:c};b.extend(d,this.blocks[c].layout);a.push(d)}if(c=this.getWorker())this.layoutInProgress++,c.postMessage({cmd:"layout",args:{blocks:a,viewport:this.viewport,signature:this.layoutSign},jBlocksIndex:this.jBlocksIndex});else try{b.jBlocks("log","workerless layout");var e=b.jBlocks.worker.layout(a,this.viewport,this.layoutData);b.jBlocks("log","workerless layout done");this.layouts=e;this.applyLayout();this.layoutDone()}catch(h){alert("Workerless exception: "+h+" "+h.sourceURL+":"+h.line)}}};c.prototype.doCheckLayout=
function(){for(var a in this.blocks){var c=this.blocks[a];"function"==typeof c.options.w&&(c.layout.w=Math.max(1,c.options.w.call(c,this.viewport)));"function"==typeof c.options.h&&(c.layout.h=Math.max(1,c.options.h.call(c,this.viewport)))}a=this.getLayoutSign();a==this.layoutSign?null!=this.layouts&&(a=b.jBlocks.util.md5(JSON.stringify({_1:this.geometry.uWidth,_2:this.geometry.uHeight})),0==this.layoutInProgress&&a!=this.geometrySizeSign&&(this.geometrySizeSign=a,this.applyLayout())):(this.layoutSign=
a,this.rebuild())};c.prototype.checkLayout=function(){if(D){var a=this;this.jBlocksLayoutTimer&&clearTimeout(this.jBlocksLayoutTimer);this.jBlocksLayoutTimer=setTimeout(function(){this.jBlocksLayoutTimer=null;a.doCheckLayout()},this.options.layoutDelay)}};c.prototype.makeScrollable=function(){function a(c,d){var e,h,j,f,g,k;2>arguments.length&&(d=1);switch(c){case "down":e="r";h="h";j="top";f="uHeight";g="rows";k=1;break;case "up":e="r";h="h";j="top";f="uHeight";g="rows";k=-1;break;case "right":e=
"c";h="w";j="left";f="uWidth";g="cols";k=1;break;case "left":e="c",h="w",j="left",f="uWidth",g="cols",k=-1}for(var m=Math.ceil(d/b.geometry[f]),x=b.viewport[e];Math.abs(x-b.viewport[e])<m;){var l=-1,J;for(J in b.layoutData.rmk[g]){var n=b.layoutData.rmk[g][J];if((0<k&&n>b.viewport[e]||0>k&&n<b.viewport[e])&&(0>k||n+b.viewport[h]<=b.layoutData.maxSize[h])&&(0>l||0<k&&n<l||0>k&&n>l))l=n}if(0<=l)b.viewport[e]=l,n={},n[j]=-l*b.geometry[f],b.frameContent.stop().animate(n,b.options.scrollAnimateDelay);
else break}}if(D){var b=this;this.anchor.bind("mousewheel DOMMouseScroll",function(c){var d;if(c.detail)d=0>c.detail?1:-1;else if(c.wheelDelta)d=0<c.wheelDelta?1:-1;else if(c.originalEvent)if(c.originalEvent.wheelDelta)d=0<c.originalEvent.wheelDelta?1:-1;else if(c.originalEvent.detail)d=0>c.originalEvent.detail?1:-1;else return;else return;c.ctrlKey||("width"==b.viewport.fixed?0>d?a("down"):a("up"):"height"==b.viewport.fixed&&(0>d?a("right"):a("left")));c.stopPropagation()});this.anchor.swipe({swipeLeft:function(b,
c,d){a("right",d);b.stopPropagation()},swipeRight:function(b,c,d){a("left",d);b.stopPropagation()},swipeUp:function(b,c,d){a("down",d);b.stopPropagation()},swipeDown:function(b,c,d){a("up",d);b.stopPropagation()}});this.scrollable=!0}};c.prototype.unmakeScrollable=function(){this.anchor.swipe("destroy");this.anchor.unbind("mousewheel DOMMouseScroll")};c.prototype.updateViewportFromGeometry=function(a,c,d){var e={pixels:150,minw:6,maxw:15,minh:7,maxh:12};2<arguments.length&&b.extend(e,d);c.w=Math.round(a.width/
e.pixels);c.w<e.minw&&(c.w=e.minw);c.w>e.maxw&&(c.w=e.maxw);c.h=Math.round(a.height/e.pixels);c.h<e.minh&&(c.h=e.minh);c.h>e.maxh&&(c.h=e.maxh)};c.prototype.getFullscreenMethods=function(){var a=["","moz","webkit","o","ms"],b=null,c;for(c in a){var d=a[c],e=(d+"RequestFullScreen").substr(0,1).toLowerCase()+(d+"RequestFullScreen").substr(1);if("function"==typeof this.anchor[0][e]){b={request:e,event:d+"fullscreenchange",element:(d+"FullScreenElement").substr(0,1).toLowerCase()+(d+"FullScreenElement").substr(1)};
switch(d){case "webkit":b.element="webkitCurrentFullScreenElement"}break}}return b};c.prototype.pushLayout=function(){var a={},b;for(b in this.blocks)a[this.blocks[b].id]=JSON.parse(JSON.stringify(this.blocks[b].layout));this.layoutsStack.push(a)};c.prototype.popLayout=function(){var a=this.layoutsStack.pop(),b;for(b in a){var c=a[b],d=this.blocks[b];d&&(d.layout=c)}};c.prototype.hideAllBlocks=function(){for(var a in this.blocks)this.blocks[a].layout.visible=!1};c.prototype.updateSize=function(){this.anchor.trigger("jBlocks.resize",
{width:this.anchor.width(),height:this.anchor.height()})};c.prototype.canFullscreen=function(){return null!=this.fullscreenMethods};c.prototype.fullscreen=function(a,c){if(0==arguments.length||!a)a=this.anchor;2>arguments.length&&(c=function(){});var d=this.fullscreenMethods;if(d){var e=document[d.element],h=a.width(),j=a.height();b(document).bind(d.event,function(){setTimeout(function(){var f,g,k;document[d.element]?(k=!0,a.addClass("jblocks-full-size"),f=document[d.element].offsetWidth,g=document[d.element].offsetHeight,
b.jBlocks("log","entered fullScreen",f,"x",g)):(k=!1,a.removeClass("jblocks-full-size"),f=h,g=j,b(document).unbind(d.event),b.jBlocks("log","exited fullScreen",f,"x",g));e&&(e.width(f),e.height(g));c(k)},0)});a[0][d.request]()}};var U=[],L=[],D=!1;b(document).ready(function(){if(!D){D=!0;for(var a in m)b.jBlocks("log",m[a]);m=[];for(a in U)U[a].init();U=null;for(a in L){var c=L[a];c[0].apply(c[1],c[2])}L=null}});var K=null,I,A,O=null,Q=null,T={};b.jBlocks=function(a){switch(a){case "defineBlockClass":return v.apply(null,
arguments);case "autoSyncContentSize":var e=function(){b("body").trigger("jBlocks.resize",{width:b("body").width(),height:b("body").height()})};b(window).bind("orientationchange resize",function(){e()});b(document).ready(function(){e()});break;case "log":var f=Array.prototype.slice.call(arguments,1);t.apply(n(),[(new Date).getTime()-h].concat(f));break;case "addTranslation":return f=Array.prototype.slice.call(arguments,1),s.apply(null,f);case "translate":return f=Array.prototype.slice.call(arguments,
1),l.apply(null,f);case "getFrameData":return Array.prototype.slice.call(arguments,1),q.call(null);case "addSound":f=Array.prototype.slice.call(arguments,1);D?d.apply(null,f):L.push([d,null,f]);break;case "playSound":f=Array.prototype.slice.call(arguments,1);D?j.apply(null,f):L.push([j,null,f]);break;case "click":return O||(O="click","ontouchstart"in document.documentElement&&(O="touchstart")),O;case "getBlockAnonIndex":return p++;default:if("function"!=typeof c.prototype[a])throw"jBlocks: no such method "+
a;var g=n(),f=Array.prototype.slice.call(arguments,1);return c.prototype[a].apply(g,f)}};b.fn.jBlocks=function(){var a=this.first(),b=new c(a);b.anchor=a;b.init();b.updateSize();return b}})(jQuery);
(function(b){b.jBlocks.util={md5:function(a){function b(a,c){var d,e,f,j,g;f=a&2147483648;j=c&2147483648;d=a&1073741824;e=c&1073741824;g=(a&1073741823)+(c&1073741823);return d&e?g^2147483648^f^j:d|e?g&1073741824?g^3221225472^f^j:g^1073741824^f^j:g^f^j}function d(a,d,e,f,j,g,k){a=b(a,b(b(d&e|~d&f,j),k));return b(a<<g|a>>>32-g,d)}function j(a,d,e,f,j,g,k){a=b(a,b(b(d&f|e&~f,j),k));return b(a<<g|a>>>32-g,d)}function n(a,d,e,f,j,g,k){a=b(a,b(b(d^e^f,j),k));return b(a<<g|a>>>32-g,d)}function t(a,d,e,f,
j,g,k){a=b(a,b(b(e^(d|~f),j),k));return b(a<<g|a>>>32-g,d)}function s(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var l=[],q,v,r,f,g,e,k,m,l=a.replace(/\r\n/g,"\n");a="";for(q=0;q<l.length;q++)v=l.charCodeAt(q),128>v?a+=String.fromCharCode(v):(127<v&&2048>v?a+=String.fromCharCode(v>>6|192):(a+=String.fromCharCode(v>>12|224),a+=String.fromCharCode(v>>6&63|128)),a+=String.fromCharCode(v&63|128));l=a;a=l.length;q=a+8;v=16*((q-q%64)/64+1);
r=Array(v-1);for(g=f=0;g<a;)q=(g-g%4)/4,f=8*(g%4),r[q]|=l.charCodeAt(g)<<f,g++;q=(g-g%4)/4;r[q]|=128<<8*(g%4);r[v-2]=a<<3;r[v-1]=a>>>29;l=r;g=1732584193;e=4023233417;k=2562383102;m=271733878;for(a=0;a<l.length;a+=16)q=g,v=e,r=k,f=m,g=d(g,e,k,m,l[a+0],7,3614090360),m=d(m,g,e,k,l[a+1],12,3905402710),k=d(k,m,g,e,l[a+2],17,606105819),e=d(e,k,m,g,l[a+3],22,3250441966),g=d(g,e,k,m,l[a+4],7,4118548399),m=d(m,g,e,k,l[a+5],12,1200080426),k=d(k,m,g,e,l[a+6],17,2821735955),e=d(e,k,m,g,l[a+7],22,4249261313),
g=d(g,e,k,m,l[a+8],7,1770035416),m=d(m,g,e,k,l[a+9],12,2336552879),k=d(k,m,g,e,l[a+10],17,4294925233),e=d(e,k,m,g,l[a+11],22,2304563134),g=d(g,e,k,m,l[a+12],7,1804603682),m=d(m,g,e,k,l[a+13],12,4254626195),k=d(k,m,g,e,l[a+14],17,2792965006),e=d(e,k,m,g,l[a+15],22,1236535329),g=j(g,e,k,m,l[a+1],5,4129170786),m=j(m,g,e,k,l[a+6],9,3225465664),k=j(k,m,g,e,l[a+11],14,643717713),e=j(e,k,m,g,l[a+0],20,3921069994),g=j(g,e,k,m,l[a+5],5,3593408605),m=j(m,g,e,k,l[a+10],9,38016083),k=j(k,m,g,e,l[a+15],14,3634488961),
e=j(e,k,m,g,l[a+4],20,3889429448),g=j(g,e,k,m,l[a+9],5,568446438),m=j(m,g,e,k,l[a+14],9,3275163606),k=j(k,m,g,e,l[a+3],14,4107603335),e=j(e,k,m,g,l[a+8],20,1163531501),g=j(g,e,k,m,l[a+13],5,2850285829),m=j(m,g,e,k,l[a+2],9,4243563512),k=j(k,m,g,e,l[a+7],14,1735328473),e=j(e,k,m,g,l[a+12],20,2368359562),g=n(g,e,k,m,l[a+5],4,4294588738),m=n(m,g,e,k,l[a+8],11,2272392833),k=n(k,m,g,e,l[a+11],16,1839030562),e=n(e,k,m,g,l[a+14],23,4259657740),g=n(g,e,k,m,l[a+1],4,2763975236),m=n(m,g,e,k,l[a+4],11,1272893353),
k=n(k,m,g,e,l[a+7],16,4139469664),e=n(e,k,m,g,l[a+10],23,3200236656),g=n(g,e,k,m,l[a+13],4,681279174),m=n(m,g,e,k,l[a+0],11,3936430074),k=n(k,m,g,e,l[a+3],16,3572445317),e=n(e,k,m,g,l[a+6],23,76029189),g=n(g,e,k,m,l[a+9],4,3654602809),m=n(m,g,e,k,l[a+12],11,3873151461),k=n(k,m,g,e,l[a+15],16,530742520),e=n(e,k,m,g,l[a+2],23,3299628645),g=t(g,e,k,m,l[a+0],6,4096336452),m=t(m,g,e,k,l[a+7],10,1126891415),k=t(k,m,g,e,l[a+14],15,2878612391),e=t(e,k,m,g,l[a+5],21,4237533241),g=t(g,e,k,m,l[a+12],6,1700485571),
m=t(m,g,e,k,l[a+3],10,2399980690),k=t(k,m,g,e,l[a+10],15,4293915773),e=t(e,k,m,g,l[a+1],21,2240044497),g=t(g,e,k,m,l[a+8],6,1873313359),m=t(m,g,e,k,l[a+15],10,4264355552),k=t(k,m,g,e,l[a+6],15,2734768916),e=t(e,k,m,g,l[a+13],21,1309151649),g=t(g,e,k,m,l[a+4],6,4149444226),m=t(m,g,e,k,l[a+11],10,3174756917),k=t(k,m,g,e,l[a+2],15,718787259),e=t(e,k,m,g,l[a+9],21,3951481745),g=b(g,q),e=b(e,v),k=b(k,r),m=b(m,f);return(s(g)+s(e)+s(k)+s(m)).toLowerCase()},sha1:function(a){function b(a,c){return a<<c|a>>>
32-c}function d(a){var b="",c,d;for(c=7;0<=c;c--)d=a>>>4*c&15,b+=d.toString(16);return b}var j,n,t=Array(80),s=1732584193,l=4023233417,q=2562383102,v=271733878,r=3285377520,f,g,e,k,m;j=a.replace(/\r\n/g,"\n");var p="";for(a=0;a<j.length;a++)n=j.charCodeAt(a),128>n?p+=String.fromCharCode(n):(127<n&&2048>n?p+=String.fromCharCode(n>>6|192):(p+=String.fromCharCode(n>>12|224),p+=String.fromCharCode(n>>6&63|128)),p+=String.fromCharCode(n&63|128));a=p;f=a.length;p=[];for(j=0;j<f-3;j+=4)n=a.charCodeAt(j)<<
24|a.charCodeAt(j+1)<<16|a.charCodeAt(j+2)<<8|a.charCodeAt(j+3),p.push(n);switch(f%4){case 0:j=2147483648;break;case 1:j=a.charCodeAt(f-1)<<24|8388608;break;case 2:j=a.charCodeAt(f-2)<<24|a.charCodeAt(f-1)<<16|32768;break;case 3:j=a.charCodeAt(f-3)<<24|a.charCodeAt(f-2)<<16|a.charCodeAt(f-1)<<8|128}for(p.push(j);14!=p.length%16;)p.push(0);p.push(f>>>29);p.push(f<<3&4294967295);for(a=0;a<p.length;a+=16){for(j=0;16>j;j++)t[j]=p[a+j];for(j=16;79>=j;j++)t[j]=b(t[j-3]^t[j-8]^t[j-14]^t[j-16],1);n=s;f=l;
g=q;e=v;k=r;for(j=0;19>=j;j++)m=b(n,5)+(f&g|~f&e)+k+t[j]+1518500249&4294967295,k=e,e=g,g=b(f,30),f=n,n=m;for(j=20;39>=j;j++)m=b(n,5)+(f^g^e)+k+t[j]+1859775393&4294967295,k=e,e=g,g=b(f,30),f=n,n=m;for(j=40;59>=j;j++)m=b(n,5)+(f&g|f&e|g&e)+k+t[j]+2400959708&4294967295,k=e,e=g,g=b(f,30),f=n,n=m;for(j=60;79>=j;j++)m=b(n,5)+(f^g^e)+k+t[j]+3395469782&4294967295,k=e,e=g,g=b(f,30),f=n,n=m;s=s+n&4294967295;l=l+f&4294967295;q=q+g&4294967295;v=v+e&4294967295;r=r+k&4294967295}m=d(s)+d(l)+d(q)+d(v)+d(r);return m.toLowerCase()}}})(jQuery);
"undefined"==typeof $&&($={});"undefined"==typeof $.jBlocks&&($.jBlocks={});
$.jBlocks.worker={supported:!1,log:function(){if($.jBlocks.worker.supported){for(var b=[],a=0;a<arguments.length;a++){var c=arguments[a];"string"!=typeof c&&(c=JSON.stringify(c));b.push(""+c)}self.postMessage({cmd:"log",args:{str:b.join(" ")}})}else $.jBlocks.apply(["log"].concat(arguments))},extend:function(b){for(var a=1;a<arguments.length;a++){var c=arguments[a],d;for(d in c)b[d]=c[d]}},layout:function(b,a,c,d){function j(b){var d=[],e;for(e in c.rmk.rows)for(var f in c.rmk.cols)d.push({r:c.rmk.rows[e],
c:c.rmk.cols[f]}),b&&("width"==a.fixed&&d.push({r:c.rmk.rows[e]+b.h,c:c.rmk.cols[f]}),"height"==a.fixed&&d.push({r:c.rmk.rows[e],c:c.rmk.cols[f]+b.w}));b=[];e={};for(f=0;f<d.length-1;f++)for(var j=f+1;j<d.length;j++){var g=d[f],h=d[j];g.r!=h.r&&g.c!=h.c&&(g={r:Math.min(g.r,h.r),c:Math.min(g.c,h.c),h:Math.abs(h.r-g.r),w:Math.abs(h.c-g.c)},h=g.c+","+g.r+"-"+g.w+"x"+g.h,e[h]||(e[h]=!0,b.push(g)))}return b}b.sort(function(a,b){return b.priority-a.priority});c.rmk.rows={"0":0};c.rmk.rows[a.h]=a.h;c.rmk.cols=
{"0":0};c.rmk.cols[a.w]=a.w;c.misfits={};for(var n=[],t=[],s={w:-1,h:-1};0<b.length;){var l=b.shift();if(l.visible){for(var q=j(l),v=[],r=0;r<q.length;r++){var f=q[r];if(l.w<=f.w&&l.h<=f.h){for(var g=!0,e=0;e<n.length&&g;e++)if(h=n[e],!(h.r+h.block.h<=f.r||h.r>=f.r+f.h||h.c+h.block.w<=f.c||h.c>=f.c+f.w)){g=!1;break}g&&v.push(f)}}h=l.pref;if(!l.pref||"default"==l.pref)h="height"==a.fixed?"left top":"top left";var f=null,k=function(b,c){return b.r<a.h&&c.r>=a.h?-1:c.r<a.h&&b.r>=a.h?1:Math.abs(b.r+b.h-
a.h)-Math.abs(c.r+c.h-a.h)},m=function(b,c){return Math.abs(b.c+b.w-a.w)-Math.abs(c.c+c.w-a.w)},p=function(a,b){return a.w*a.h-b.w*b.h};switch(h){case "top right":f=function(a,b){return a.r-b.r||m(a,b)||p(a,b)};break;case "right top":f=function(a,b){return m(a,b)||a.r-b.r||p(a,b)};break;case "bottom left":f=function(a,b){return k(a,b)||a.c-b.c||p(a,b)};break;case "left bottom":f=function(a,b){return a.c-b.c||k(a,b)||p(a,b)};break;case "bottom right":f=function(a,b){return k(a,b)||m(a,b)||p(a,b)};
break;case "right bottom":f=function(a,b){return m(a,b)||k(a,b)||p(a,b)};break;case "left top":f=function(a,b){return a.c-b.c||a.r-b.r||p(a,b)};break;case "top left":f=function(a,b){return a.r-b.r||a.c-b.c||p(a,b)};break;case "center":f=function(b,c){var d=Math.min(b.c+b.w,a.w)-b.c,e=Math.min(b.r+b.h,a.h)-b.r,f=Math.min(c.c+c.w,a.w)-c.c,g=Math.min(c.r+c.h,a.h)-c.r;return f*g-d*e};break;default:$jBlocks("log","Unknown block.pref",l.pref)}v.sort(f);if(0==v.length){f=0;for(q=n.length-1;0<=q;q--)h=n[q],
h.block.importance<l.importance&&($.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:{block:h.block},misfit:!0},jBlocksIndex:d}),c.misfits[h.block.id]=!0,b.unshift(h.block),n.splice(q,1),f++);0==f?(c.misfits[l.id]=!0,$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:{block:l},misfit:!0},jBlocksIndex:d})):b.unshift(l)}else{q="left";r="top";l.pref&&(0<=l.pref.indexOf("right")&&(q="right"),0<=l.pref.indexOf("bottom")&&(r="bottom"),0<=l.pref.indexOf("center")&&
(q=r="center"));f=v[0];h={r:"top"==r?f.r:f.r+f.h-l.h,c:"left"==q?f.c:f.c+f.w-l.w,h:l.h,w:l.w,block:l};switch(r){case "top":h.r=f.r;break;case "bottom":h.r=f.r+f.h-l.h;break;case "center":h.r=f.r+Math.floor((f.h-l.h)/2)}switch(q){case "left":h.c=f.c;break;case "right":h.c=f.c+f.w-l.w;break;case "center":h.c=f.c+Math.floor((f.w-l.w)/2)}c.rmk.rows[h.r]=h.r;c.rmk.rows[h.r+h.block.h]=h.r+h.block.h;c.rmk.cols[h.c]=h.c;c.rmk.cols[h.c+h.block.w]=h.c+h.block.w;delete c.misfits[h.block.id];$.jBlocks.worker.supported&&
self.postMessage({cmd:"layout",args:{layout:h,misfit:!1},jBlocksIndex:d});n.push(h);if(0>s.w||h.c+h.block.w>s.w)s.w=h.c+h.block.w;if(0>s.h||h.r+h.block.h>s.h)s.h=h.r+h.block.h}}else{var h={block:l,visible:!1};t.push(h);$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:h,misfit:!1},jBlocksIndex:d})}}a.frameSize=s;c.maxSize={w:0,h:0};for(e=0;e<n.length;e++)h=n[e],c.maxSize.h<h.r+h.h&&(c.maxSize.h=h.r+h.h),c.maxSize.w<h.c+h.w&&(c.maxSize.w=h.c+h.w);c.rmk.rows={"0":0};c.rmk.rows[a.h]=
a.h;c.rmk.cols={"0":0};c.rmk.cols[a.w]=a.w;for(e=0;e<n.length;e++)h=n[e],c.rmk.rows[h.r]=h.r,c.rmk.rows[h.r+h.h]=h.r+h.h,c.rmk.cols[h.c]=h.c,c.rmk.cols[h.c+h.w]=h.c+h.w;c.maxSize.h>a.h&&(c.rmk.rows[c.maxSize.h-a.h]=c.maxSize.h-a.h);c.maxSize.w>a.w&&(c.rmk.cols[c.maxSize.w-a.w]=c.maxSize.w-a.w);if(a.fillHoles){q=j(null);q.sort(function(a,b){return b.w*b.h-a.w*a.h});for(b=!0;b;){b=!1;for(r=0;r<q.length&&!b;r++){f=q[r];s=!0;for(e=0;e<n.length&&s;e++)if(h=n[e],!(h.r+h.h<=f.r||h.r>=f.r+f.h||h.c+h.w<=f.c||
h.c>=f.c+f.w)){s=!1;break}if(s&&(f.c+f.w<=c.maxSize.w||f.c+f.w<=a.w)&&(f.r+f.h<=c.maxSize.h||f.r+f.h<=a.h)){s=[];for(e=0;e<n.length;e++)h=n[e],c.misfits[h.block.id]||(0<h.block.expandWidth&&(h.r>=f.r&&h.r+h.h<=f.r+f.h)&&(h.c+h.w==f.c&&s.push({li:e,change:{w:h.w+f.w},weight:"expandWidth"}),f.c+f.w==h.c&&s.push({li:e,change:{c:h.c-f.w,w:h.w+f.w},weight:"expandWidth"})),0<h.block.expandHeight&&(h.c>=f.c&&h.c+h.w<=f.c+f.w)&&(h.r+h.h==f.r&&s.push({li:e,change:{h:h.h+f.h},weight:"expandHeight"}),f.r+f.h==
h.r&&s.push({li:e,change:{r:h.r-f.h,h:h.h+f.h},weight:"expandHeight"})));0<s.length&&(b=!0,s.sort(function(a,b){return n[b.li].block[b.weight]-n[a.li].block[a.weight]}),s=s[0],h=n[s.li],$.jBlocks.worker.extend(h,s.change),$.jBlocks.worker.supported&&self.postMessage({cmd:"layout",args:{layout:h,misfit:!1},jBlocksIndex:d}))}}}}return n.concat(t)}};
self&&"function"==typeof self.addEventListener&&self.addEventListener("message",function(b){if(b.data&&b.data.cmd)try{var a=b.data;switch(a.cmd){case "layout":$.jBlocks.worker.supported=!0;b={rmk:{rows:{},cols:{}},maxSize:{w:1,h:1}};var c=$.jBlocks.worker.layout(a.args.blocks,a.args.viewport,b,a.jBlocksIndex);self.postMessage({cmd:"layouts",args:{layouts:c,layoutData:b,signature:a.args.signature},jBlocksIndex:a.jBlocksIndex})}}catch(d){$.jBlocks.worker.log("Error "+a.cmd+": "+d)}},!1);
$.jBlocks("defineBlockClass","Block","Class",{init:function(b,a){2>arguments.length&&(a={});1>arguments.length&&(b={});this.id=a.id?a.id:"anon-"+$.jBlocks("getBlockAnonIndex");this.layout={priority:0,importance:0,w:1,h:1,pref:"default",visible:!0,expandWidth:1,expandHeight:1};this.actualLayout={w:1,h:1};$.extend(this.layout,b);this.maximized=!1;this.jBlocks=null;this.className="Block";this.options={blockClass:null,blockContentClass:null,margin:null,padding:null,borderRadius:0.07,contentBorderRadius:0,
capture:!1,maximizable:!0,requireAuth:!1,requireAnon:!1,autoFit:!1,debugBlockLayout:!1,onCreate:function(){},onRemove:function(){},onResize:function(){},onStartResize:function(){},tooltip:null,earlyLayout:!0};this.tags={};$.extend(this.options,a);this.options.requireAuth&&null==$.jBlocks.loggedIn&&(this.layout.visible=!1);this.options.requireAnon&&null!=$.jBlocks.loggedIn&&(this.layout.visible=!1)},create:function(b){this.options.layouts&&("undefined"==typeof this.options.layoutIndex&&(this.options.layoutIndex=
Math.floor((this.options.layouts.length-1)/2)),this.options.w=function(b){var c=a.options.layouts[a.options.layoutIndex];switch(typeof c.w){case "number":return c.w;case "function":return c.w.call(a,b);default:return a.layout.w}},this.options.h=function(b){var c=a.options.layouts[a.options.layoutIndex];switch(typeof c.h){case "number":return c.h;case "function":return c.h.call(a,b);default:return a.layout.h}});var a=this,c=this.options.blockClass||this.jBlocks.options.blockClass;this.anchor=$("<div/>").appendTo(b.children(".jblocks-frame").children(".jblocks-frame-content"));
this.anchor.addClass("jblocks-block").addClass("jblocks-"+this.jBlocks.jBlocksIndex).attr("id","jblocks-block-"+this.jBlocks.jBlocksIndex+"-"+this.id).css({top:$("body").height()/2,left:$("body").width()/2,width:1,height:1});c&&this.anchor.addClass(c);(this.options.debugBlockLayout||this.jBlocks.options.debugBlockLayout)&&this.anchor.bind("mouseover",function(b){$("head title").text(a.className+" "+JSON.stringify(a.layout));b.stopPropagation()});this.captMask=$("<div/>").addClass("jblocks-block-mask").appendTo(this.anchor);
b=this.options.blockContentClass||this.jBlocks.options.blockContentClass;this.content=$("<div/>").addClass("jblocks-block-content").appendTo(this.anchor);b&&this.content.addClass(b);this.options.tooltip&&this.content.attr("title",this.options.tooltip);this.onCreate();this.options.onCreate.call(this)},onRemove:function(){this.anchor&&this.anchor.remove();this.options.onRemove()},remove:function(){this.jBlocks.removeBlock(this.id)},canGrow:function(){return this.options.layouts&&this.options.layoutIndex<
this.options.layouts.length-1},grow:function(){this.canGrow()&&(this.options.layoutIndex++,this.jBlocks.checkLayout(),this.focus())},canShrink:function(){return this.options.layouts&&0<this.options.layoutIndex},shrink:function(){this.canShrink()&&(this.options.layoutIndex--,this.jBlocks.checkLayout(),this.focus())},focus:function(){this.jBlocks.focusBlockId(this.id)},addTag:function(b){this.tags[b]=!0},maximize:function(){!this.maximized&&this.options.maximizable&&($.extend(options,options0),this.jBlocks.pushLayout(),
this.jBlocks.hideAllBlocks(),this.layout.visible=!0,this.layout.w=this.jBlocks.viewport.w,this.layout.h=this.jBlocks.viewport.h,this.jBlocks.checkLayout(),this.maximized=!0)},unMaximize:function(){this.maximized&&(this.jBlocks.popLayout(),this.maximized=!1,this.jBlocks.checkLayout())},onCreate:function(){},onStartResize:function(b){this.options.onStartResize.call(this,b)},getContentGeometry:function(b,a,c){a=Math.min(a,c);c=this.jBlocks.options.margin;this.options.margin&&(c=this.options.margin);
var d=this.jBlocks.options.padding;this.options.padding&&(d=this.options.padding);var j={"margin-top":a*c[0],"margin-bottom":a*c[2],"margin-left":a*c[3],"margin-right":a*c[1],"padding-top":a*d[0],"padding-bottom":a*d[2],"padding-left":a*d[3],"padding-right":a*d[1],"border-left":parseInt(this.anchor.css("border-left-width")),"border-right":parseInt(this.anchor.css("border-right-width")),"border-top":parseInt(this.anchor.css("border-top-width")),"border-bottom":parseInt(this.anchor.css("border-bottom-width"))};
return{spacing:j,sizeRef:a,width:b.width-(c[1]+c[3])*a-(d[1]+d[3])*a-j["border-left"]-j["border-right"],height:b.height-(c[0]+c[2])*a-(d[0]+d[2])*a-j["border-right"]-j["border-bottom"]}},onResize:function(b){b=this.getContentGeometry(b,this.jBlocks.geometry.uWidth,this.jBlocks.geometry.uHeight);this.content.width(b.width);this.content.height(b.height);this.content.css("border-radius",b.sizeRef*this.options.contentBorderRadius+"px");this.anchor.css({"margin-top":b.spacing["margin-top"]+"px","margin-bottom":b.spacing["margin-bottom"]+
"px","margin-left":b.spacing["margin-left"]+"px","margin-right":b.spacing["margin-right"]+"px","padding-top":b.spacing["padding-top"]+"px","padding-bottom":b.spacing["padding-bottom"]+"px","padding-left":b.spacing["padding-left"]+"px","padding-right":b.spacing["padding-right"]+"px"});this.anchor.width(b.width);this.anchor.height(b.height);this.anchor.css("border-radius",b.sizeRef*this.options.borderRadius+"px");this.captMask.width(this.anchor.outerWidth(!1)-b.spacing["border-left"]-b.spacing["border-right"]);
this.captMask.height(this.anchor.outerHeight(!1)-b.spacing["border-top"]-b.spacing["border-bottom"]);this.options.capture?this.captMask.show():this.captMask.hide();this.options.onResize.call(this,b);var a=this.jBlocks.options.blockShadow;"undefined"!=typeof this.options.shadow&&(a=this.options.shadow);if(0!=a){var c=this.jBlocks.geometry.uWidth*a,d=this.jBlocks.geometry.uHeight*a,a=b.sizeRef*a;this.anchor.css({"-webkit-box-shadow":"-"+c+"px "+d+"px "+2.5*a+"px rgba(43, 45, 50, 0.55)","box-shadow":"-"+
c+"px "+d+"px "+2.5*a+"px rgba(43, 45, 50, 0.55)"})}this.display(b)},display:function(){},onLoggedIn:function(b){this.options.requireAuth&&!1==this.layout.visible&&(this.layout.visible=!0,this.jBlocks.checkLayout());this.options.requireAnon&&!0==this.layout.visible&&(this.layout.visible=!1,this.jBlocks.checkLayout());if(this.onLoggedInCallback)this.onLoggedInCallback(b)},onLoggedOut:function(){this.options.requireAuth&&!0==this.layout.visible&&(this.layout.visible=!1,this.jBlocks.checkLayout());this.options.requireAnon&&
!1==this.layout.visible&&(this.layout.visible=!0,this.jBlocks.checkLayout());if(this.onLoggedOutCallback)this.onLoggedOutCallback()},canFullscreen:function(){return null!=this.jBlocks.fullscreenMethods},fullscreen:function(b,a){if(1>arguments.length||!b)b=this.content;if(2>arguments.length||!a)udateFnt=function(){};this.jBlocks.fullscreen(b,a)},log:function(){$.jBlocks.apply(null,["log"].concat([].splice.call(arguments,0)))},t:function(){return $.jBlocks.apply(null,["translate"].concat([].splice.call(arguments,
0)))}});
$.jBlocks("defineBlockClass","Foo","Block",{init:function(){this._super.apply(this,arguments);this.letter=String.fromCharCode(65+this.constructor.fooIndex++)},onCreate:function(){this.content.css({"background-color":"rgba("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+",0.5)","text-align":"center"}).text(this.letter);this._super.call(this)},display:function(b){this.content.css({"line-height":b.height+"px","font-size":Math.min(b.height/2,0.8*b.width)+
"pt"})}}).fooIndex=0;
$.jBlocks("defineBlockClass","HtmlElement","Block",{element:null,init:function(){this._super.apply(this,arguments);this.options=$.extend({emargin:[0,0,0,0],epadding:[0,0,0,0],tag:"p"},this.options)},onCreate:function(){this.element=$("<"+this.options.tag+"/>").appendTo(this.content)},display:function(){var b=Math.min(this.jBlocks.geometry.uWidth,this.jBlocks.geometry.uHeight),a=b*this.options.emargin[0],c=b*this.options.emargin[1],d=b*this.options.emargin[2],j=b*this.options.emargin[3],n=b*this.options.epadding[0],
t=b*this.options.epadding[1],s=b*this.options.epadding[2],b=b*this.options.epadding[3],l=parseInt(this.element.css("border-top-width"))+parseInt(this.element.css("border-bottom-width")),q=parseInt(this.element.css("border-left-width"))+parseInt(this.element.css("border-right-width"));this.element.css({"margin-top":a+"px","margin-right":c+"px","margin-bottom":d+"px","margin-left":j+"px","padding-top":n+"px","padding-right":t+"px","padding-bottom":s+"px","padding-left":b+"px",height:this.content.height()-
n-a-s-d-l,width:this.content.width()-b-j-t-c-q})}});
$.jBlocks("defineBlockClass","Text","HtmlElement",{init:function(b,a){this._super.apply(this,arguments);this.options=$.extend({text:"",multiline:!1,containerTag:"p",emRatio:0.6,blockClass:"jblocks-simpletext"},this.options);this.options.tag=this.options.containerTag;this.options.epadding=[0,0.1,0,0.1]},onCreate:function(){this._super.apply(this);this.element.text(this.options.text)},display:function(b){this._super.apply(this,arguments);this.adjustSize(b)},adjustSize:function(b){this.options.multiline||
(this.element.addClass("jblocks-simpletext-single"),this.element.css({"line-height":b.height+"px"}))},textVal:function(){var b=this.element.text.apply(this.element,arguments);0<arguments.length&&(this.options.text=arguments[0],this.adjustSize({width:this.content.width(),height:this.content.height()}));return b}});
$.jBlocks("defineBlockClass","Image","Block",{init:function(b,a){this._super.apply(this,arguments);this.options=$.extend({onClick:null,stretch:"keep-ratio"},this.options);this.imageLoaded=!1;this.img=null;this.image=new Image},onCreate:function(){var b=this;this._super.apply(this,arguments);this.options.onClick&&(this.content.addClass("jblocks-clickable"),this.content.bind($.jBlocks("click"),function(){b.options.onClick.call(b)}));this.img=$("<img/>").appendTo(this.content);this.image.onload=function(){b.imageLoaded=
!0;b.img.attr("src",b.image.src);b.updateImage()};this.image.src=this.options.src},updateImage:function(){if(this.imageLoaded&&!(0>=this.content.width()||0>=this.content.height())){var b,a,c=0,d=0;"full-extend"==this.options.stretch?(b=this.content.width(),a=this.content.height()):"no-oversampling"==this.options.stretch&&this.image.width<this.content.width()&&this.image.height<this.content.height()?(b=this.image.width,a=this.image.height,c=(this.content.height()-this.image.height)/2,d=(this.content.width()-
this.image.width)/2):(a=this.image.width/this.image.height,b=this.content.width()/this.content.height(),a<b?(b=this.content.height()*a,a=this.content.height(),c=0,d=(this.content.width()-b)/2):(b=this.content.width(),a=this.content.width()/a,d=0,c=(this.content.height()-a)/2));this.img.css({width:b,height:a,"margin-left":d,"margin-top":c})}},display:function(){this.updateImage()}});
$.jBlocks("defineBlockClass","Input","HtmlElement",{init:function(){this._super.apply(this,arguments);this.options=$.extend({onCR:function(){},onKeyDown:function(){},text:""},this.options);this.options.tag="input";this.options.blockClass="jblocks-block-input"},onCreate:function(){this._super.apply(this);var b=this;this.element.val(this.options.text).bind("keydown",function(a){13==a.keyCode?b.options.onCR.call(b):b.options.onKeyDown.call(b,a.keyCode)})},display:function(){this._super.apply(this,arguments);
this.element.css({"font-size":0.6*this.element.height()+"pt"})},val:function(){return this.element.val.apply(this.element,arguments)}});
$.jBlocks("defineBlockClass","Checkbox","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({checked:!1,onChange:function(){},text:""},this.options);this.layout.expandHeight=0;this.options.blockContentClass="jblocks-clickable"},onCreate:function(){var b=this;this._super.apply(this);b=this;this.input=$("<div/>").addClass("jblocks-checkbox-ticker").css({"float":"left"}).appendTo(this.content);this.text=$("<p/>").text(this.options.text).css({"float":"left",margin:0}).appendTo(this.content);
this.content.bind($.jBlocks("click"),function(){b.options.checked=!b.options.checked;b.updateState();b.options.onChange.call(b,b.options.checked)});this.updateState()},updateState:function(){this.options.checked?this.input.addClass("jblocks-checkbox-checked"):this.input.removeClass("jblocks-checkbox-checked")},display:function(){this._super.apply(this,arguments);var b=this.content.height();this.input.css({height:b,width:b});this.text.css({"padding-left":b/4+"px","line-height":b+"px"})},val:function(){if(0<
arguments.length){var b=this.options.checked;this.options.checked=!arguments[0]?!1:!0;b!=this.options.checked&&(this.updateState(),this.options.onChange.call(this,this.options.checked))}return this.options.checked}});
$.jBlocks("defineBlockClass","Link","Text",{init:function(){this._super.apply(this,arguments);this.options=$.extend({onClick:function(){},attributes:{},iconUrl:null,iconPosition:"left",minTextW:1,noIconOverlay:!0,backgroundClass:"jblocks-block-green-link"},this.options)},onCreate:function(){var b=this;this._super();this.content.addClass("jblocks-block-link");this.content.addClass(this.options.backgroundClass);for(var a in this.options.attributes)this.text.attr(a,this.options.attributes[a]);this.content.bind($.jBlocks("click"),
function(){b.options.onClick.call(b)});this.options.iconUrl&&(this.iconImage=$("<div/>").css({"background-image":"url("+this.options.iconUrl+")","background-position":"center center","background-repeat":"no-repeat","background-size":"contain",position:"absolute",padding:0,margin:0,top:0}).appendTo(this.content),"left"==this.options.iconPosition?this.iconImage.css({left:0}):this.iconImage.css({right:0}),this.options.noIconOverlay&&("left"==this.options.iconPosition?this.options.epadding[3]=1:this.options.epadding[1]=
1),this.content.css("text-align",this.options.textAlign));this.element.hide()},display:function(){this.actualLayout.w<this.options.minTextW?this.textVal(""):this.textVal(this.options.text);this.element.show();this._super.apply(this,arguments);this.iconImage&&this.iconImage.css({width:this.content.width()/this.actualLayout.w*this.actualLayout.h,height:this.content.height()})}});
$.jBlocks("defineBlockClass","JBlock","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({jBlocksBlockClass:null,jBlocksBlockContentClass:null},this.options)},onCreate:function(){var b=this;this.selfJBlocks=this.content.jBlocks();this.selfJBlocks.updateOptions({onResize:function(a,c){var d=b.actualLayout.h||1;a.height/d<b.options.minPixels&&(d=Math.max(Math.floor(a.height/b.options.minPixels),1));0<b.options.minh&&d<b.options.minh&&(d=b.options.minh);0<b.options.maxh&&
d>b.options.maxh&&(d=b.options.maxh);var j=b.actualLayout.w||1;a.width/j<b.options.minPixels&&(j=Math.max(Math.floor(a.width/b.options.minPixels),1));0<b.options.minw&&j<b.options.minw&&(j=b.options.minw);0<b.options.maxw&&j>b.options.maxw&&(j=b.options.maxw);c.h=d;c.w=j},blockClass:this.options.jBlocksBlockClass,blockContentClass:this.options.jBlocksBlockContentClass});this.selfJBlocks.updateViewport({w:1,h:1,fixed:"both"});this.selfJBlocks.updateOptions({resizeDelay:5,layoutDelay:5,resizeAnimateDelay:100,
debugBlockLayout:this.jBlocks.options.debugBlockLayout})},onStartResize:function(b,a){this.onResize(a);this.content.trigger("jBlocks.resize",null)},onRemove:function(){this._super();this.selfJBlocks&&this.selfJBlocks.removeAllBlocks()},display:function(){},addNewBlock:function(){this.selfJBlocks.addNewBlock.apply(this.selfJBlocks,arguments);return this}});
$.jBlocks("defineBlockClass","Menu","JBlock",{init:function(b,a){this._super.apply(this,arguments);$.extend(this.options,{blockContentClass:"jblocks-block-menu"});this.options=$.extend({w:1,h:1,menuItems:[]},this.options)},onCreate:function(){var b=this;this._super();this.selfJBlocks.viewport.fixed="width";this.selfJBlocks.options.scrollable=!0;this.layout.h=this.jBlocks.viewport.h-1;this.layout.w=this.jBlocks.viewport.w;this.menuItems=[];for(var a in this.options.menuItems){var c={label:"--",onClick:function(){},
shouldDisplay:function(){return!0}};$.extend(c,this.options.menuItems[a]);var d=this.selfJBlocks.addNewBlock("Link",{w:1,h:1,pref:"left top",expandHeight:0,expandWidth:0},{text:c.label,containerTag:"a"});this.menuItems.push({data:c,block:d});(function(a){d.anchor.bind(jBlocks("click"),function(){a.onClick.call(b)})})(c)}this.selfJBlocks.updateOptions({onResize:function(a,c){c.w=b.options.w}})},display:function(){this._super();var b=0,a;for(a in this.menuItems){var c=this.menuItems[a];c.data.shouldDisplay()?
(c.block.layout.visible=!0,b++):c.block.layout.visible=!1}b=Math.min(b,this.jBlocks.viewport.h-1);this.layout.h=b;this.layout.w=4;this.jBlocks.checkLayout();this.selfJBlocks.updateViewport({h:b})}});
$.jBlocks("defineBlockClass","Icon","Block",{init:function(){this._super.apply(this,arguments);$.extend(this.layout,{w:1,h:1,expandWidth:0,expandHeight:0});this.options=$.extend({iconClass:"jblocks-block-icon",onClick:function(){}},this.options)},onCreate:function(){var b=this;this.content.addClass(this.options.iconClass);this.content.bind($.jBlocks("click"),function(){b.options.onClick.call(b)})}});
$.jBlocks("defineBlockClass","MenuIcon","Icon",{init:function(){var b=this;this._super.apply(this,arguments);$.extend(this.options,{blockContentClass:"jblocks-icon-menu",onClick:function(){b.menuClick()}});this.options=$.extend({menuItems:[]},this.options);this.menu=null},menuClick:function(){null==this.menu?this.menu=this.jBlocks.addNewBlock("Menu",{priority:1001,w:1,h:1,pref:"left top",expandWidth:0,expandHeight:0},{menuItems:this.options.menuItems}):(this.menu.layout.visible=this.menu.layout.visible?
!1:!0,this.jBlocks.checkLayout())}});
$.jBlocks("defineBlockClass","IFrame","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({src:"about:blank",data:null,syncViewportSize:!1},this.options)},onCreate:function(){var b=this;this.frame=$("<iframe/>").attr("frameborder","0").attr("scrolling","no").attr("marginwidth","0").attr("marginheight","0").attr("allowTransparency",!0).attr("webkitallowfullscreen",!0).attr("mozallowfullscreen",!0).attr("allowfullscreen",!0).css({"background-color":"transparent"});this.options.syncViewportSize&&
(this.options.data||(this.options.data={}),$.extend(this.options.data,{onResize:function(a,c){!b.jBlocks.canFullscreen()||!document[b.jBlocks.fullscreenMethods.element]?(c.w=b.actualLayout.w,c.h=b.actualLayout.h):this.options.defaultOnResize.call(this,a,c)}}));if(this.options.data){"undefined"==typeof $.jBlocks.frameData&&($.jBlocks.frameData={index:0,data:this.options.data});var a=$.jBlocks.frameData,c=a.index++;a.data[c]=this.options.data;this.frame.attr("name","jblocks-data-"+c)}this.frame.appendTo(this.content)},
display:function(b){this.frame.attr("width",b.width).attr("height",b.height);0<b.width&&(0<b.height&&void 0===this.frame.attr("src"))&&this.frame.attr("src",this.options.src)}});
$.jBlocks("defineBlockClass","Box","JBlock",{init:function(){this._super.apply(this,arguments);this.options=$.extend({title:"",focusOnTitleClick:!0,haveClose:!1,haveSearch:!1,haveMaximize:!0,haveFullscreen:!1,haveLogo:!1,logoIconClass:"jblocks-block-icon-logo",closeIconClass:"jblocks-icon-close",shrinkIconClass:"jblocks-icon-shrink",growIconClass:"jblocks-icon-grow",searchIconClass:"jblocks-icon-search",iconsBaseClass:"jblocks-block-icon",menuItems:[],onSearchClick:function(){}},this.options)},onCreate:function(){var b=
this;this._super();var a=this.selfJBlocks.options.onResize;this.selfJBlocks.options.onResize=function(){a.apply(this,arguments);b.options.layouts&&(b.growIcon.layout.visible=b.canGrow()?!0:!1,b.shrinkIcon.layout.visible=b.canShrink()?!0:!1)};var c=[];this.options.haveFullscreen&&c.push({label:this.t("fullscreen"),onClick:function(){this.layout.visible=!1;b.fullscreen(b.selfJBlocks.anchor,function(a){a?b.maximize():b.unMaximize();$(window).trigger("resize")})},shouldDisplay:function(){return b.canFullscreen()}});
for(var d in this.options.menuItems)c.push(this.options.menuItems[d]);this.options.haveLogo&&this.selfJBlocks.addNewBlock("Icon",{priority:1100,pref:"top left"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.logoIconClass});0<c.length&&this.selfJBlocks.addNewBlock("MenuIcon",{priority:1003,pref:"top left",h:1,w:1,expandHeight:0},{onClick:function(){alert("Open menu")},menuItems:c});this.options.haveClose&&this.selfJBlocks.addNewBlock("Icon",{priority:1002,pref:"top left"},{iconClass:this.options.iconsBaseClass,
blockContentClass:this.options.closeIconClass,onClick:function(){b.unMaximize();b.jBlocks.removeBlock(b.id)},tooltip:this.t("close")});this.options.haveSearch&&this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.searchIconClass,onClick:function(){b.options.onSearchClick.apply(b)},tooltip:this.t("search")});this.options.layouts&&(this.growIcon=this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},
{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.growIconClass,onClick:function(){b.grow()},tooltip:this.t("grow")}),this.shrinkIcon=this.selfJBlocks.addNewBlock("Icon",{priority:1001,pref:"top right"},{iconClass:this.options.iconsBaseClass,blockContentClass:this.options.shrinkIconClass,onClick:function(){b.shrink()},tooltip:this.t("shrink")}));c=this.selfJBlocks.addNewBlock("Text",{h:1,w:2,priority:1E3,expandWidth:10,expandHeight:0},{containerTag:"h1",text:this.options.title});
this.options.focusOnTitleClick?(c.content.bind($.jBlocks("click"),function(){b.focus();b.jBlocks.checkLayout()}),c.content.css({cursor:"pointer"})):c.content.css({cursor:"default"})},setContent:function(b,a){2>arguments.length&&(a={});for(var c in this.selfJBlocks.blocks){var d=this.selfJBlocks.blocks[c];d._isBoxContent&&this.selfJBlocks.removeBlock(d.id)}c=this.selfJBlocks.addNewBlock(b,{w:1,h:2,pref:"right bottom",priority:999,expandWidth:2,expandHeight:2},$.extend(a,{boxBlock:this}));c._isBoxContent=
!0;return c}});
$.jBlocks("defineBlockClass","ScrollableHtml","Block",{init:function(){this._super.apply(this,arguments);this.options=$.extend({htmlContent:"",scrollAnimation:0,verticalAlign:!1},this.options)},onCreate:function(){var b=this,a=this.content;this.scrollCtrl=$("<div/>").addClass("jb-scroll-list").appendTo(this.content);var c=$("<div/>").addClass("scrollbar").appendTo(this.scrollCtrl),d=$("<div/>").addClass("track").appendTo(c);$("<div/>").addClass("tracktop").appendTo(d);var j=$("<div/>").addClass("thumb").appendTo(d);$("<div/>").addClass("top").appendTo(j);
$("<div/>").addClass("bottom").appendTo(j);a=$("<div/>").addClass("viewport").appendTo(this.scrollCtrl);a=this.scrollViewport=$("<div/>").addClass("overview").appendTo(a);this.content.bind("mousewheel DOMMouseScroll",function(a){if(!c.hasClass("disable")){var b=0>a.detail||0<a.wheelDelta?1:-1,s=j.position();0<b&&0==s.top||0>b&&s.top+j.height()>=d.height()||a.stopPropagation()}});a.html(this.options.htmlContent);this.scrollCtrl.tinyscrollbar({animation:this.options.scrollAnimation}).bind("updatelayout",
function(){b.checkState()})},checkState:function(){var b=this.content.height()-(this.scrollViewport.outerHeight(!0)-this.scrollViewport.height());this.scrollViewport.css("min-height",0);this.viewportHeight=this.scrollViewport.height();this.scrollViewport.css("min-height",b);if(this.scrollCtrl.position()){var a=this.scrollCtrl.parent().outerHeight()-this.scrollCtrl.position().top,b=this.scrollCtrl.children(".viewport");b.css({height:a});try{this.scrollCtrl.css({height:a}),this.scrollCtrl.tinyscrollbar_update()}catch(c){this.log("error updating tinyscrollbar "+
this.jBlocks.jBlocksIndex)}var a=this.scrollCtrl.parent().outerWidth(),d=this.scrollCtrl.children(".scrollbar").hasClass("disable")?a:a-15;this.scrollCtrl.css({width:a});b.css({width:d});this.scrollViewport.css({width:d});this.scrollCtrl.tinyscrollbar_update()}},display:function(){this.scrollViewport.css("padding-top",0);this.checkState();var b=this.scrollCtrl.height()-this.viewportHeight;this.options.verticalAlign&&0<b&&this.scrollViewport.css("padding-top",b/2)},getHtmlContainer:function(){return this.scrollViewport},
scrollBottom:function(){this.scrollCtrl.tinyscrollbar_update("bottom")},scrollTop:function(){this.scrollCtrl.tinyscrollbar_update(0)},makeVisible:function(b,a){var c=this.scrollCtrl.children(".viewport"),d=c.children(".overview"),j=-d.position().top;if(b<j||b+a>j+c.height())j=b-(c.height()-a)/2,j=Math.max(0,j),j=Math.min(d.height()-c.height(),j),this.scrollCtrl.tinyscrollbar_update(j)}});
$.jBlocks("defineBlockClass","List","JBlock",{init:function(){this._super.apply(this,arguments);this.options=$.extend({items:[],createItem:function(){return null},searchItem:null,haveSearch:!1,showSearch:!1,itemHeightRatio:0.66},this.options);this.options.scrollAnimation=400;this.items={};this.lastSearch=this.search=null},onCreate:function(){var b=this;this._super();this.options.haveSearch&&(this.search=this.selfJBlocks.addNewBlock("Input",{h:1,w:1,pref:"top left",priority:100,expandHeight:0,expandWidth:2,
visible:this.options.showSearch},{emargin:[0.1,0,0.1,0],epadding:[0.1,0,0.1,0],blockContentClass:"jblocks-list-search"}),$.jBlocks("log","search onCreate"),this.search.element.bind("input",function(a){var c=b.search.element.val();c!=b.lastSearch&&(b.lastSearch=c,b.filter());a.stopPropagation();b.refresh()}));this.content.addClass("jblocks-block-list");this.ul=$("<ul/>");this.list=this.selfJBlocks.addNewBlock("ScrollableHtml",{h:1,w:1,pref:"left top"},{onCreate:function(){this.getHtmlContainer().append(b.ul)},
contentBorderRadius:0,margin:[0,0,0,0],scrollAnimation:400,verticalAlign:!1});for(var a in this.options.items){var c=$("<li/>"),d=this.options.createItem.call(this,this.options.items[a],c);d&&(c.appendTo(this.ul),this.items[d]={li:c,data:this.options.items[a]})}},filter:function(b){var a=this.items;0<arguments.length&&(a={},a[b]=this.items[b]);for(var c in a){var d=a[c];if(this.lastSearch){var j=!1;null==this.options.searchItem?0<=d.li.html().replace(/<.*?>/g," ").toLowerCase().indexOf(this.lastSearch.toLowerCase())&&
(j=!0):this.options.searchItem(d.data,this.lastSearch)&&(j=!0);j?d.li.show():d.li.hide()}else d.li.show()}},updateLi:function(b){var a=Math.min(this.jBlocks.geometry.uHeight,this.jBlocks.geometry.uWidth)*this.options.itemHeightRatio,c=0.8*a,d=0.1*a;b.css({height:a,"line-height":a+"px"}).find("img").css({height:c,width:"auto",margin:d})},display:function(){this.updateLi(this.ul.children("li"));this.refresh()},sort:function(){if("function"==typeof this.options.sortFn){var b=[],a;for(a in this.items)b.push(a);
var c=this;b.sort(function(a,b){return c.options.sortFn(c.items[a].data,c.items[b].data)});for(var d in b)this.items[b[d]].li.detach().appendTo(this.ul)}},addItem:function(b){var a=$("<li/>"),c=this.options.createItem(b,a);c&&(a.appendTo(this.ul),this.items[c]={li:a,data:b},this.anchor&&this.updateLi(a));this.options.onItemAdded&&this.options.onItemAdded.call(this,b)},removeItem:function(b){if("undefined"!=typeof this.items[b]){var a=this.items[b];a.li.remove();delete this.items[b];this.options.onItemRemoved&&
this.options.onItemRemoved.call(this,a)}},clearAll:function(){this.ul.empty();this.items={}},refresh:function(){this.sort();this.list.checkState();this.options.onRefresh&&this.options.onRefresh.call(this)},toggleSearch:function(){this.search.layout.visible=!this.search.layout.visible;this.selfJBlocks.checkLayout()},scrollBottom:function(){this.list.scrollBottom()},scrollTop:function(){this.list.scrollTop()},shuffle:function(){var b=[],a;for(a in this.items)b.push(this.items[a].li.detach());a=b.length;
if(!(0>=a)){for(;--a;){var c;c=Math.floor(Math.random()*(a+1));var d=b[a];b[a]=b[c];b[c]=d}for(a in b)this.ul.append(b[a])}},ensureVisible:function(b){if(b=this.items[b]){var a=b.li.position();this.list.makeVisible(a.top,b.li.height())}}});
$.jBlocks("defineBlockClass","Select","List",{init:function(){var b=this;this._super.apply(this,arguments);this.options=$.extend({opened:!1,selected:null,selWidgetClass:"jblocks-block-grey",onChange:function(){}},this.options);this.superCreateItem=this.options.createItem;this.options.createItem=function(a,c){var d=b.superCreateItem.call(this,a,c);c.bind($.jBlocks("click"),function(){b.val(d);b.list.layout.visible=!1;b.selWidget.layout.visible=!0;b.selfJBlocks.checkLayout();b.options.opened=!1;b.jBlocks.checkLayout()});
return d};this.superH=this.options.h;this.superLayoutH=this.layout.h;this.options.h=function(a){return b.options.opened?b.superH?b.superH.call(b,a):this.superLayoutH:1}},updateSelected:function(){var b="";this.ul.find("li").removeClass("jblocks-selected");null!=this.options.selected&&this.items[this.options.selected]&&(b=this.items[this.options.selected].li.text(),this.items[this.options.selected].li.addClass("jblocks-selected"));this.selWidget.textVal(b)},addItem:function(b){this._super(b);b.value==
this.options.selected&&this.updateSelected()},onCreate:function(){var b=this;this._super.apply(this,arguments);this.selWidget=this.selfJBlocks.addNewBlock("Link",{h:1,w:b.layout.w,expandHeight:0},{text:"",epadding:[0,1,0,0],onClick:function(){b.list.layout.visible=!0;b.selWidget.layout.visible=!1;b.selfJBlocks.checkLayout();b.options.opened=!0;b.jBlocks.checkLayout()}});this.selWidget.content.addClass("jblocks-select");this.selWidget.anchor.addClass(this.options.selWidgetClass);this.options.opened?
(this.list.layout.visible=!0,this.selWidget.layout.visible=!1):(this.list.layout.visible=!1,this.selWidget.layout.visible=!0);this.updateSelected()},val:function(){if(0<arguments.length){var b=arguments[0];b!=this.options.selected&&(this.options.selected=b,this.updateSelected(),this.options.onChange.call(this,b))}return this.options.selected}});
$.jBlocks("defineBlockClass","YouTubeVideo","IFrame",{init:function(){this._super.apply(this,arguments);$.extend(this.options,{src:"http://www.youtube.com/embed/"+this.options.youtubeID});this.options=$.extend({blockContentClass:"jblocks-block-video"},this.options)}});$.jBlocks("defineBlockClass","Spacer","Block",{init:function(){this._super.apply(this,arguments)}});
$.jBlocks("defineBlockClass","Log","ScrollableHtml",{init:function(){this._super.apply(this,arguments);this.options.padding=[0.15,0.15,0.15,0.15];this.nbEntries=0;this.options=$.extend({refreshPeriod:500,maxEntries:100},this.options)},onCreate:function(){var b=this;this._super.call(this);this.getHtmlContainer().addClass("jblocks-log").css({"background-color":"White",border:"2px inset #808080",padding:5});this.updateTimer=setInterval(function(){b.updateLog()},this.options.refreshPeriod)},onRemove:function(){this.updateTimer&&
clearInterval(this.updateTimer)},updateLog:function(){var b=this.getHtmlContainer().children().length;b!=this.nbEntries&&(b-=this.options.maxEntries,0<b&&this.getHtmlContainer().children().slice(0,b).remove(),this.checkState(),this.scrollBottom(),this.nbEntries=this.getHtmlContainer().children().length)},display:function(){this._super();this.scrollBottom()},clearLog:function(){this.getHtmlContainer().empty();this.checkState()}});
$.jBlocks("defineBlockClass","LogBox","Box",{init:function(){var b=this;this._super.apply(this,arguments);this.options.title=this.t("Log");this.options.jBlocksBlockClass="jblocks-block-brown";this.options.haveClose=!0;this.options.menuItems.push({label:"Clear",onClick:function(){this.layout.visible=!1;b.clearLog()}})},onCreate:function(){this._super();this.logPanel=this.setContent("Log")},clearLog:function(){this.logPanel.clearLog()}});
$.jBlocks("defineBlockClass","TextBox","Box",{init:function(){this._super.apply(this,arguments);this.options=$.extend({text:"",multiline:!1,containerTag:"p"},this.options)},onCreate:function(){this._super();this.textPanel=this.setContent("Text",{text:this.options.text,containerTag:this.options.containerTag,multiline:this.options.multiline})}});
$.jBlocks("defineBlockClass","ScrollableHtmlBox","Box",{init:function(){this._super.apply(this,arguments);this.options=$.extend({htmlContent:""},this.options)},onCreate:function(){this._super();this.textPanel=this.setContent("ScrollableHtml",{htmlContent:this.options.htmlContent})}});$.jBlocks("defineBlockClass","Persona","IFrame",{init:function(){this._super.apply(this,arguments);$.extend(this.options,{src:"/jblocks/login/persona",onLogin:function(){},onLogout:function(){}})},onCreate:function(){this._super()}});
$.jBlocks("defineBlockClass","PersonaBox","JBlock",{init:function(){this._super.apply(this,arguments);$.extend(this.layout,{expandHeight:0,expandWidth:0.1});this.highlight()},onCreate:function(){this._super();var b=this;this.userBox=this.selfJBlocks.addNewBlock("Text",{w:1,h:1,expandHeight:0,visible:!1},{verticalAlign:!0,blockContentClass:"jblocks-logged-as"});this.selfJBlocks.addNewBlock("Persona",{w:1,h:2,pref:"left bottom"},{});$(document).bind("jblocks.logincreate",function(){b.options.w=function(a){return a.w};
b.options.h=function(a){return a.h};b.focus();b.jBlocks.checkLayout()});$(document).bind("jblocks.logincancel",function(){delete b.options.w;delete b.options.h;b.jBlocks.checkLayout()});$(document).bind("jblocks.login",function(a,c){b.unhighlight();b.userBox.textVal(b.t("logged-as",{"@name":c.name}));b.userBox.layout.visible=!0;b.options.onLogin.call(b,c);b.selfJBlocks.checkLayout();b.jBlocks.checkLayout()});$(document).bind("jblocks.logout",function(){b.highlight();b.userBox.layout.visible=!1;b.options.onLogout.call(b);
b.selfJBlocks.checkLayout();b.jBlocks.checkLayout()})},highlight:function(){$.extend(this.layout,{priority:1200,w:4,h:2,pref:"top right"})},unhighlight:function(){$.extend(this.layout,{priority:0,w:4,h:3,pref:"bottom right"})}});
